<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>Amorki&#39;s</title>
    <meta name="author" content="">
    
	<meta name="description" content=""> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="Amorki&#39;s" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

<meta name="generator" content="Hexo 5.0.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Amorki&#39;s
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
    
        <!-- GitHub -->
        <li>
            <a target="_blank" rel="noopener" href="https://github.com/amorkiki" class="github" title="Github"></a>
        </li>
        
            
                    
                        <!-- Facebook -->
                        <li>
                            <a target="_blank" rel="noopener" href="http://www.facebook.com/kiki.wu.92167789" class="facebook" title="Facebook"></a>
                        </li>
                        
                            
                                <!-- Twitter -->
                                <li>
                                    <a target="_blank" rel="noopener" href="http://www.twitter.com/BENICEXKiki" class="twitter" title="Twitter"></a>
                                </li>
                                
                                    
                                            
                                                    
                                                            
                                                                <!-- Instagram -->
                                                                <li>
                                                                    <a target="_blank" rel="noopener" href="http://www.instagram.com/wuuuuuujt" class="instagram" title="Instagram"></a>
                                                                </li>

                                                                
</ul>

<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="http://yoursite.com" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        



  <article class="post">
	<h2 class="title">
		<a href="2019/07/18/http-ReadNotes-04/">http_ReadNotes-04</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-07-18T15:21:26.000Z" itemprop="datePublished">Jul 18, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/http/">http</a>
</div>
    </div>
      
        <h1 id="V-与HTTP协作的Web服务器"><a href="#V-与HTTP协作的Web服务器" class="headerlink" title="V. 与HTTP协作的Web服务器"></a>V. 与HTTP协作的Web服务器</h1><p>一台 Web 服务器可搭建多个独立域名的 Web 网站，也可作为通信路 径上的中转服务器提升传输效率。</p>
<h2 id="5-1-用单台虚拟主机实现多个域名"><a href="#5-1-用单台虚拟主机实现多个域名" class="headerlink" title="5.1 用单台虚拟主机实现多个域名"></a><strong>5.1</strong> 用单台虚拟主机实现多个域名</h2><p>HTTP/1.1 规范允许一台 HTTP 服务器搭建多个 Web 站点。</p>
<p>提供 Web 托管服务(Web Hosting Service)的供应商，可以用一台服务器为多位客户服务，也可以以每位客户持有的域名运行各自不同的网站。这是因为利用了<code>虚拟主机</code>(Virtual Host，又称虚拟服务器)的功能。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopwi7vkgj30i30d5dgt.jpg"></p>
<p>客户端使用 HTTP 协议访问服务器时，会经常采用类似 <a target="_blank" rel="noopener" href="http://www.hackr.jp/">www.hackr.jp</a> 这样的主机名和域名。</p>
<p>在互联网上，域名通过 DNS 服务映射到 IP 地址(域名解析)之后访问目标网站。</p>
<p>当请求发送到服务器时，已经是以 IP 地址形式访问了。</p>
<p>所以，如果一台服务器内托管了 <a target="_blank" rel="noopener" href="http://www.tricorder.jp/">www.tricorder.jp</a> 和 <a target="_blank" rel="noopener" href="http://www.hackr.jp/">www.hackr.jp</a> 这 两个域名，当收到请求时就需要弄清楚究竟要访问哪个域名。</p>
<p>在相同的 IP 地址下，由于虚拟主机可以寄存多个不同主机名和域名 的 Web 网站，因此在发送 HTTP 请求时，必须在 Host 首部内完整指 定主机名或域名的 URI。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopyxahuqj30ev09omxy.jpg"></p>
<h2 id="5-2-通信数据转发程序-代理、网关、隧道"><a href="#5-2-通信数据转发程序-代理、网关、隧道" class="headerlink" title="5.2 通信数据转发程序 :代理、网关、隧道"></a><strong>5.2</strong> 通信数据转发程序 :代理、网关、隧道</h2><p>HTTP 通信时，除客户端和服务器以外，还有一些用于<code>通信数据转发的应用程序</code>可以配合服务器工作。</p>
<p>将请求转发给通信线路上的下一站服务器，并且能接收从那台服务器发送的响应再转发给客户端。</p>
<h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p>代理是一种<code>有转发功能的应用程序</code>，它扮演了位于服务器和客户端“中间人”的角色，接收由客户端发送的请求并转发给服务器，同时 也接收服务器返回的响应并转发给客户端。</p>
<ul>
<li>代理不改变请求 URI，会直接发送给前方持有资源的目标服务器。</li>
<li>持有资源实体的服务器被称为源服务器。从源服务器返回的响应经过 代理服务器后再传给客户端。</li>
<li>在 HTTP 通信过程中，可级联多台代理服务器。请求和响应的转发会 经过数台类似锁链一样连接起来的代理服务器。</li>
<li>转发时，需要附加 Via 首部字段以标记出经过的主机信息。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoq5962glj30jl07d0tk.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoq6k52ppj30j2084q42.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoq7m3detj30g4079wf1.jpg"></p>
<p>使用代理服务器的理由:</p>
<ul>
<li>利用缓存技术减少网络带宽的流量，</li>
<li>组织内部针对特定网站的访问控制，以获取访问日志为主要目的</li>
</ul>
<p>代理有多种使用方法：</p>
<ul>
<li>是否使用缓存</li>
<li>是否会修改报文</li>
</ul>
<p><code>缓存代理</code></p>
<p>代理转发响应时，缓存代理(Caching Proxy)会预先将资源的副本 (缓存)保存在代理服务器上。</p>
<p>当代理再次接收到对相同资源的请求时，就可以不从源服务器那里获取资源，而是将之前缓存的资源作为响应返回。</p>
<p><code>透明代理</code></p>
<p>转发请求或响应时，不对报文做任何加工的代理类型被称为透明代理 (Transparent Proxy)。反之，对报文内容进行加工的代理被称为非 透明代理。</p>
<h3 id="网关"><a href="#网关" class="headerlink" title="网关"></a>网关</h3><p>网关是<code>转发其他服务器通信数据的服务器</code>，接收从客户端发送来的请求时，它就像自己拥有资源的源服务器一样对请求进行处理。有时客户端可能都不会察觉，自己的通信目标是一个网关。</p>
<ul>
<li>网关能使通信线路上的服务器提供非 HTTP 协议服务。</li>
<li>利用网关能提高通信的安全性，在客户端与网关之间的通信线路上加密确保连接的安全。</li>
<li>网关可以连接数据库，使用 SQL 语句查询数据。</li>
<li>在 Web 购物网站上进行信用卡结算时， 网关可以和信用卡结算系统联动。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoq9mopetj30ii05jdg7.jpg"></p>
<h3 id="隧道"><a href="#隧道" class="headerlink" title="隧道"></a>隧道</h3><p>隧道是在<code>相隔甚远的客户端和服务器两者之间进行中转</code>，并保持双方通信连接的应用程序。</p>
<ul>
<li>届时使用 SSL 等加密手段进行通信。</li>
<li>目的是确保客户端能与服务器进行安全的通信。</li>
<li>隧道本身不会去解析 HTTP 请求。—–请求保持原样中转给之后的服务器。</li>
<li>隧道会在通信双方断开连接时结束。</li>
<li>隧道本身是透明的，客户端不用在意隧道的存在</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqfvvnzoj30j204fwes.jpg"></p>
<h2 id="5-3-保存资源的缓存"><a href="#5-3-保存资源的缓存" class="headerlink" title="5.3 保存资源的缓存"></a><strong>5.3</strong> 保存资源的缓存</h2><p><code>缓存</code>——代理服务器或客户端本地磁盘内保存的资源副本。</p>
<p>利用缓存可减少对源服务器的访问，节省通信流量和通信时间。</p>
<p><code>缓存服务器</code>是代理服务器的一种，并归类在缓存代理类型中。</p>
<p>当代理转发从服务器返回的响应时，代理服务器将会保存一份资 源的副本。</p>
<p>利用缓存可避免多次从源服务器转发资源。</p>
<p>客户端可就近从缓存服务器上获取资源，而源服务器也不必多次处 理相同的请求了。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqjp2bohj30jr0hlwg7.jpg"></p>
<h3 id="5-3-1-缓存的有效期限"><a href="#5-3-1-缓存的有效期限" class="headerlink" title="5.3.1 缓存的有效期限"></a><strong>5.3.1</strong> 缓存的有效期限</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoql8swl0j30jm0amjsa.jpg"></p>
<h3 id="5-3-2-客户端的缓存"><a href="#5-3-2-客户端的缓存" class="headerlink" title="5.3.2 客户端的缓存"></a><strong>5.3.2</strong> 客户端的缓存</h3><p>缓存不仅可以存在于缓存服务器内，还可以存在客户端浏览器中。</p>
<p>以 <code>Internet Explorer</code> 程序为例，把客户端缓存称为<code>临时网络文件</code> (Temporary Internet File)。</p>
<p>浏览器缓存如果有效，就不必再向服务器请求相同的资源了，可以直 接从本地磁盘内读取。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqmly6c7j30dz0a2mxm.jpg"></p>
<h2 id="在-HTTP-出现之前的协议"><a href="#在-HTTP-出现之前的协议" class="headerlink" title="在 HTTP 出现之前的协议"></a>在 <strong>HTTP</strong> 出现之前的协议</h2><blockquote>
<p>在 HTTP 普及之前，也就是从互联网的诞生期至今，曾出现过各式各样的协议。在 HTTP 规范确立之际，制定者们参考了那些协议的 功能。也有某些协议现在已经彻底退出了人们的视线。接下来，简单介绍一下这些协议。</p>
<p><strong>FTP</strong>(<strong>File Transfer Protocol</strong>)</p>
<p>传输文件时使用的协议。该协议历史久远，可追溯到 1973 年前 后，比 TCP/IP 协议族的出现还要早。虽然它在 1995 年被 HTTP 的 流量(Traffic)超越，但时至今日，仍被广泛沿用。</p>
<p><strong>NNTP</strong>(<strong>Network News Transfer Protocol</strong>)</p>
<p>用于 NetNews 电子会议室内传送消息的协议。在 1986 年前后出 现，属于比较古老的一类协议。现在，利用 Web 交换信息已成主 流，所以该协议已经不怎么使用了。</p>
<p><strong>Archie</strong></p>
<p>搜索 anonymous FTP 公开的文件信息的协议。1990 年前后出现，现 在已经不常使用。</p>
<p><strong>WAIS</strong>(<strong>Wide Area Information Servers</strong>) 以关键词检索多个数据库使用的协议。1991 年前后出现。由于现</p>
<p>在已经被 HTTP 协议替代，也已经不怎么使用了。 <strong>G o phe r</strong></p>
<p>查找与互联网连接的计算机内信息的协议。1991 年前后出现，由 于现在已经被 HTTP 协议替代，也已经不怎么使用了。</p>
</blockquote>
<h1 id="VI-HTTP-首部"><a href="#VI-HTTP-首部" class="headerlink" title="VI. HTTP 首部"></a>VI. HTTP 首部</h1><h2 id="6-1-HTTP-报文首部"><a href="#6-1-HTTP-报文首部" class="headerlink" title="6.1 HTTP 报文首部"></a><strong>6.1</strong> <strong>HTTP</strong> 报文首部</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqomhiucj30i0073dg9.jpg"></p>
<h3 id="HTTP-请求报文"><a href="#HTTP-请求报文" class="headerlink" title="HTTP 请求报文"></a><strong>HTTP</strong> 请求报文</h3><p>在请求中，HTTP 报文由==方法==、==URI==、==HTTP 版本==、==HTTP 首部字段==等部分构成。</p>
<p>下面的示例是访问 <a target="_blank" rel="noopener" href="http://hackr.jp/">http://hackr.jp</a> 时，<code>请求报文</code>的首部信息。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: hackr.jp</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:13.0) Ge Accept: text/html,application/xhtml+xml,application/xml;q=0. Accept-Language: ja,en-us;q=0.7,en;q=0.3</span><br><span class="line"><span class="attribute">Accept-Encoding</span>: gzip, deflate</span><br><span class="line"><span class="attribute">DNT</span>: 1</span><br><span class="line"><span class="attribute">Connection</span>: keep-alive</span><br><span class="line"><span class="attribute">If-Modified-Since</span>: Fri, 31 Aug 2007 02:02:20 GMT If-None-Match: &quot;45bae1-16a-46d776ac&quot;</span><br><span class="line"><span class="attribute">Cache-Control</span>: max-age=0</span><br></pre></td></tr></table></figure>

<h3 id="HTTP-响应报文"><a href="#HTTP-响应报文" class="headerlink" title="HTTP 响应报文"></a><strong>HTTP</strong> 响应报文</h3><p>在响应中，HTTP 报文由 ==HTTP 版本==、==状态码(数字和原因短语)==、 ==HTTP 首部字段== 3 部分构成。</p>
<p>以下示例是之前请求访问 <a target="_blank" rel="noopener" href="http://hackr.jp/">http://hackr.jp/</a> 时，<code>返回的响应报文</code>的首部信息。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">304</span> Not Modified</span><br><span class="line"><span class="attribute">Date</span>: Thu, 07 Jun 2012 07:21:36 GMT Server: Apache</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Etag</span>: &quot;45bae1-16a-46d776ac&quot;</span><br></pre></td></tr></table></figure>

<h2 id="6-2-HTTP-首部字段"><a href="#6-2-HTTP-首部字段" class="headerlink" title="6.2 HTTP 首部字段"></a><strong>6.2</strong> <strong>HTTP</strong> 首部字段</h2><h3 id="6-2-1-HTTP-首部字段传递重要信息"><a href="#6-2-1-HTTP-首部字段传递重要信息" class="headerlink" title="6.2.1 HTTP 首部字段传递重要信息"></a><strong>6.2.1</strong> <strong>HTTP</strong> 首部字段传递重要信息</h3><p>在客户端与服务器之间以 HTTP 协议进行通信的过程中，无论是请求还是响应都会使用首部字段，它能起到<u>传递额外重要信息</u>的作用。</p>
<p>使用首部字段是<u>为了给浏览器和服务器提供</u>==报文主体大小==、==所使用的语言==、==认证信息==等内容。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoqx2vkajj30jv08nt9h.jpg"></p>
<h3 id="6-2-2-HTTP-首部字段结构"><a href="#6-2-2-HTTP-首部字段结构" class="headerlink" title="6.2.2 HTTP 首部字段结构"></a><strong>6.2.2</strong> <strong>HTTP</strong> 首部字段结构</h3><p><code>首部字段名</code>： <code>字段值</code></p>
<p>在 HTTP 首部中以 Content-Type 这个字段来表示报文主体的对象类型。  Content-Type: text/html</p>
<p>字段值对应单个 HTTP 首部字段可以有多个值  —- Keep-Alive: timeout=15, max=100</p>
<h3 id="6-2-3-4-种-HTTP-首部字段类型"><a href="#6-2-3-4-种-HTTP-首部字段类型" class="headerlink" title="6.2.3  4 种 HTTP 首部字段类型"></a>6.2.3  <strong>4</strong> 种 <strong>HTTP</strong> 首部字段类型</h3><p>根据实际用途：</p>
<h4 id="通用首部字段-General-Header-Fields"><a href="#通用首部字段-General-Header-Fields" class="headerlink" title="通用首部字段(General Header Fields)"></a>通用首部字段(<strong>General Header Fields</strong>)</h4><p>请求报文和响应报文两方都会使用的首部。</p>
<h4 id="请求首部字段-Request-Header-Fields"><a href="#请求首部字段-Request-Header-Fields" class="headerlink" title="请求首部字段(Request Header Fields)"></a>请求首部字段(<strong>Request Header Fields</strong>)</h4><p>从客户端向服务器端发送请求报文时使用的首部。补充了请求的附加 内容、客户端信息、响应内容相关优先级等信息。</p>
<h4 id="响应首部字段-Response-Header-Fields"><a href="#响应首部字段-Response-Header-Fields" class="headerlink" title="响应首部字段(Response Header Fields)"></a>响应首部字段(<strong>Response Header Fields</strong>)</h4><p>从服务器端向客户端返回响应报文时使用的首部。补充了响应的附加内容，也会要求客户端附加额外的内容信息。 </p>
<h4 id="实体首部字段-Entity-Header-Fields"><a href="#实体首部字段-Entity-Header-Fields" class="headerlink" title="实体首部字段(Entity Header Fields)"></a>实体首部字段(<strong>Entity Header Fields</strong>)</h4><p>针对请求报文和响应报文的实体部分使用的首部。补充了资源内容更 新时间等与实体有关的信息。</p>
<h3 id="6-2-4-HTTP-1-1-首部字段一览"><a href="#6-2-4-HTTP-1-1-首部字段一览" class="headerlink" title="6.2.4 HTTP/1.1 首部字段一览"></a><strong>6.2.4</strong> <strong>HTTP/1.1</strong> 首部字段一览</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor11o3avj30e40abq3r.jpg"></p>
<p>​                                                    请求首部字段</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor16d6tfj30fp0hotav.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor1mqeq8j30et0a8t9q.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor1v4q78j30e30b6q41.jpg"></p>
<h3 id="6-2-5-非-HTTP-1-1-首部字段"><a href="#6-2-5-非-HTTP-1-1-首部字段" class="headerlink" title="6.2.5 非 HTTP/1.1 首部字段"></a><strong>6.2.5</strong> 非 <strong>HTTP/1.1</strong> 首部字段</h3><p>还有 Cookie、Set-Cookie 和 Content-Disposition 等在其他 RFC 中定义的首部字段，它们的使用频率也很高。</p>
<p>这些非正式的首部字段统一归纳在 RFC4229 HTTP Header Field Registrations 中。</p>
<h3 id="6-2-6-End-to-end-首部和-Hop-by-hop-首部"><a href="#6-2-6-End-to-end-首部和-Hop-by-hop-首部" class="headerlink" title="6.2.6 End-to-end 首部和 Hop-by-hop 首部"></a><strong>6.2.6</strong> <strong>End-to-end</strong> 首部和 <strong>Hop-by-hop</strong> 首部</h3><p>HTTP 首部字段将定义成<code>缓存代理</code>和<code>非缓存代理</code>的行为，分成 2 种类型。</p>
<h4 id="端到端首部-End-to-end-Header"><a href="#端到端首部-End-to-end-Header" class="headerlink" title="端到端首部(End-to-end Header)"></a>端到端首部(<strong>End-to-end Header</strong>)</h4><p>分在此类别中的首部会转发给请求 / 响应对应的最终接收目标，且必须保存在由缓存生成的响应中，另外规定它必须被转发。</p>
<h4 id="逐跳首部-Hop-by-hop-Header"><a href="#逐跳首部-Hop-by-hop-Header" class="headerlink" title="逐跳首部(Hop-by-hop Header)"></a>逐跳首部(<strong>Hop-by-hop Header</strong>)</h4><p>分在此类别中的首部只对单次转发有效，会因通过缓存或代理而不再转发。HTTP/1.1 和之后版本中，如果要使用 hop-by-hop 首部，需提供 Connection 首部字段。</p>
<p>下面列举了 HTTP/1.1 中的逐跳首部字段。除这 8 个首部字段之外， 其他所有字段都属于端到端首部。</p>
<ul>
<li>Connection</li>
<li>Keep-Alive</li>
<li>Proxy-Authenticate </li>
<li>Proxy-Authorization </li>
<li>Trailer</li>
<li>TE</li>
<li>Transfe r-Encoding </li>
<li>Upgrade</li>
</ul>
<h2 id="6-3-HTTP-1-1-通用首部字段"><a href="#6-3-HTTP-1-1-通用首部字段" class="headerlink" title="6.3 HTTP/1.1 通用首部字段"></a><strong>6.3</strong> <strong>HTTP/1.1</strong> 通用首部字段</h2><h3 id="6-3-1-Cache-Control"><a href="#6-3-1-Cache-Control" class="headerlink" title="6.3.1 Cache-Control"></a><strong>6.3.1</strong> Cache-Control</h3><p>通过指定首部字段 Cache-Control 的指令，就能操作缓存的工作机 制。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor6f14pwj30j207ut98.jpg"></p>
<p>指令的参数是可选的，多个指令之间通过“,”分隔。首部字段 Cache-Control 的指令可用于请求及响应时。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cache-Control</span>: private, max-age=0, no-cache</span><br></pre></td></tr></table></figure>

<h4 id="Cache-Control-指令一览"><a href="#Cache-Control-指令一览" class="headerlink" title="Cache-Control 指令一览"></a><strong>Cache-Control</strong> 指令一览</h4><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor7jaab4j30f609fmy4.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor7tnfgij30ji0bfq4i.jpg"></p>
<h4 id="表示是否能缓存的指令-public-指令"><a href="#表示是否能缓存的指令-public-指令" class="headerlink" title="表示是否能缓存的指令 public 指令"></a>表示是否能缓存的指令 <strong>public</strong> 指令</h4><p>当指定使用 public 指令时，则明确表明其他用户也可利用缓存</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cache-Control</span>: public</span><br></pre></td></tr></table></figure>

<h4 id="private-指令"><a href="#private-指令" class="headerlink" title="private 指令"></a><strong>private</strong> 指令</h4><p>响应只以特定的用户作为对象，这与 public 指令的行为相反。缓存服务器会对该特定用户提供资源缓存的服务，对于其他用户发送 过来的请求，代理服务器则不会返回缓存。</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Cache-Control</span>: private</span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfor8yt220j30ik07374r.jpg"></p>
<h4 id="no-cache-指令"><a href="#no-cache-指令" class="headerlink" title="no-cache 指令"></a><strong>no-cache</strong> 指令</h4>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/06/27/http-ReadNotes-03/">http_ReadNotes-03</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-06-27T11:40:18.000Z" itemprop="datePublished">Jun 27, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/http/">http</a>
</div>
    </div>
      
        <h1 id="IV-返回结果的-HTTP-状态码"><a href="#IV-返回结果的-HTTP-状态码" class="headerlink" title="IV. 返回结果的 HTTP 状态码"></a>IV. 返回结果的 HTTP 状态码</h1><p><code>HTTP 状态码</code>负责表示客户端 HTTP 请求的返回结果、标记服务器端的处理是否正常、通知出现的错误等工作。</p>
<h2 id="4-1-状态码告知从服务器端返回的请求结果"><a href="#4-1-状态码告知从服务器端返回的请求结果" class="headerlink" title="4.1 状态码告知从服务器端返回的请求结果"></a><strong>4.1</strong> 状态码告知从服务器端返回的请求结果</h2><p><u>状态码的职责</u>： 当客户端向服务器端发送请求时，描述返回的请求结果。借助状态码，用户可以知道服务器端是正常处理了请求，还是出现了错误。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfop86haw5j30jk0bhaaz.jpg"></p>
<p>状态码如 200 OK，以 3 位数字和原因短语组成。</p>
<p>数字中的第一位指定了响应类别，后两位无分类。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfop93smf5j30j4070my0.jpg"></p>
<h2 id="4-2-2XX-成功"><a href="#4-2-2XX-成功" class="headerlink" title="4.2 2XX 成功"></a><strong>4.2</strong> <strong>2XX</strong> 成功</h2><h3 id="4-2-1-200-OK"><a href="#4-2-1-200-OK" class="headerlink" title="4.2.1       200 OK"></a><strong>4.2.1</strong>       200 OK</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopdhqdutj30jk06maah.jpg"></p>
<p>在响应报文内，随状态码一起返回的信息会因方法的不同而发生改变。比如，使用 GET 方法时，对应请求资源的实体会作为响应返回;而使用 HEAD 方法时，对应请求资源的实体首部不随报文主体作为响应返回(即在响应中只返回首部，不会返回实体的主体部分)。</p>
<h3 id="4-2-2-204-No-Content"><a href="#4-2-2-204-No-Content" class="headerlink" title="4.2.2      204 No Content"></a><strong>4.2.2</strong>      204 No Content</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopd2p2elj30ha064q3a.jpg"></p>
<p>服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分。另外，也不允许返回任何实体的主体。</p>
<p>比如， 当从浏览器发出请求处理后，返回 204 响应，那么浏览器显示的页面 不发生更新。</p>
<p>一般在<strong>只需要从客户端往服务器发送信息，而对客户端不需要发送新信息内容的情况下</strong>使用。</p>
<h3 id="4-2-3-206-Partial-Content"><a href="#4-2-3-206-Partial-Content" class="headerlink" title="4.2.3     206 Partial Content"></a><strong>4.2.3</strong>     206 Partial Content</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopf513o6j30ir06bmxk.jpg"></p>
<p>客户端进行了范围请求，而服务器成功执行了这部分的 GET 请求。响应报文中包含由 Content-Range 指定范围的实体内容。</p>
<h2 id="4-3-3XX-重定向"><a href="#4-3-3XX-重定向" class="headerlink" title="4.3 3XX 重定向"></a><strong>4.3</strong> <strong>3XX</strong> 重定向</h2><h3 id="4-3-1-301-Moved-Permanently"><a href="#4-3-1-301-Moved-Permanently" class="headerlink" title="4.3.1     301 Moved Permanently"></a><strong>4.3.1</strong>     301 Moved Permanently</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopfx7t4ij30gz06bq3b.jpg"></p>
<p><code>永久性重定向</code></p>
<p>该状态码表示请求的资源已被分配了新的 URI，以后 应使用资源现在所指的 URI。</p>
<p>如果已经把资源对应的 URI 保存为书签了，这时应该按 Location 首部字段提示的 URI 重新保存。</p>
<p>像下方给出的请求 URI，当指定资源路径的最后忘记添加斜杠“/”，就 会产生 301 状态码。</p>
<p><a target="_blank" rel="noopener" href="http://example.com/sample">http://example.com/sample</a></p>
<h3 id="4-3-2-302-Found"><a href="#4-3-2-302-Found" class="headerlink" title="4.3.2    302 Found"></a>4.3.2    302 Found</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfophpt51xj30g506x74o.jpg"></p>
<p><code>临时性重定向</code></p>
<p>该状态码表示请求的资源已被分配了新的 URI，希望用户(本次)能使用新的 URI 访问。</p>
<p>和 301 Moved Permanently 状态码相似，但 302 状态码代表的资源不是被永久移动，只是临时性质的。</p>
<p>比如，用户把 URI 保存成书签，但不会 像 301 状态码出现时那样去更新书签，而是仍旧保留返回 302 状态码 的页面对应的 URI。</p>
<h3 id="4-3-3-303-See-Other"><a href="#4-3-3-303-See-Other" class="headerlink" title="4.3.3   303 See Other"></a>4.3.3   303 See Other</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopjcpbokj30ho077t94.jpg"></p>
<p>由于请求对应的资源存在着另一个 URI，应使用 GET 方法定向获取请求的资源。</p>
<p>303 状态码和 302 Found 状态码有着相同的功能，但 303 状态码明确 表示客户端应当采用 GET 方法获取资源，这点与 302 状态码有区 别。</p>
<p>比如，当使用 POST 方法访问 CGI 程序，其执行后的处理结果是希望 客户端能以 GET 方法重定向到另一个 URI 上去时，返回 303 状态 码。虽然 302 Found 状态码也可以实现相同的功能，但这里使用 303状态码是最理想的。</p>
<p>当 301、302、303 响应状态码返回时，几乎所有的浏览器都会把 POST 改成 GET，并删除请求报文内的主体，之后请求会自动再次 发送。</p>
<p>301、302 标准是禁止将 POST 方法改变成 GET 方法的，但实际使 用时大家都会这么做。</p>
<h3 id="4-3-4-304-Not-Modified"><a href="#4-3-4-304-Not-Modified" class="headerlink" title="4.3.4    304 Not Modified"></a>4.3.4    304 Not Modified</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoplihnevj30hh06p3yv.jpg"></p>
<p>客户端发送附带条件的请求时，服务器端允许请求访问资源，但未满足条件的情况。</p>
<p>304 状态码返回时，不包含任何响应的主体部分。304 虽然被划分在 3XX 类别中，但是和重定向没有关系。</p>
<p><code>附带条件的请求</code>是指采用 GET 方法的请求报文中包含 If-Match，If-Modified- Since，If-None-Match，If-Range，If-Unmodified-Since 中任一首部。</p>
<h3 id="4-3-5-307-Temporary-Redirect"><a href="#4-3-5-307-Temporary-Redirect" class="headerlink" title="4.3.5    307 Temporary Redirect"></a>4.3.5    307 Temporary Redirect</h3><p><code>临时重定向</code></p>
<p>该状态码与 302 Found 有着相同的含义。尽管 302 标准禁止 POST 变换成 GET，但实际使用时大家并不遵守。</p>
<p>307 会遵照浏览器标准，不会从 POST 变成 GET。但是，对于处理响应时的行为，每种浏览器有可能出现不同的情况。</p>
<h2 id="4-4-4XX-客户端错误"><a href="#4-4-4XX-客户端错误" class="headerlink" title="4.4 4XX 客户端错误"></a><strong>4.4</strong> <strong>4XX</strong> 客户端错误</h2><h3 id="4-4-1-400-Bad-Request"><a href="#4-4-1-400-Bad-Request" class="headerlink" title="4.4.1    400 Bad Request"></a>4.4.1    400 Bad Request</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopp1zu1vj30gr068q39.jpg"></p>
<p>请求报文中存在<u>语法错误</u>。当错误发生时，需修改请求 的内容后再次发送请求。</p>
<p>另外，浏览器会像 200 OK 一样对待该状态 码。</p>
<h3 id="4-4-2-401-Unauthorized"><a href="#4-4-2-401-Unauthorized" class="headerlink" title="4.4.2   401 Unauthorized"></a><strong>4.4.2</strong>   401 Unauthorized</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoppj6o2cj30gr0diq46.jpg"></p>
<p>发送的请求需要有通过 HTTP 认证(BASIC 认证、 DIGEST 认证)的认证信息。</p>
<p>若之前已进行过 1 次请求，则表示 用户认证失败。</p>
<p>返回含有 401 的响应必须包含一个适用于被请求资源的 WWW- Authenticate 首部用以质询(challenge)用户信息。</p>
<p>当浏览器初次接收 到 401 响应，会弹出认证用的对话窗口。</p>
<h3 id="4-4-3-403-Forbidden"><a href="#4-4-3-403-Forbidden" class="headerlink" title="4.4.3     403 Forbidden"></a><strong>4.4.3</strong>     403 Forbidden</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopqkl824j30fv05o74k.jpg"></p>
<p>对请求资源的访问被服务器拒绝了。服务器端没有必要 给出拒绝的详细理由，但如果想作说明的话，可以在实体的主体部分对原因进行描述，这样就能让用户看到了。</p>
<p> 未获得文件系统的访问授权，访问权限出现某些问题(从未授权的发送源 IP 地址试图访问)等列举的情况都可能是发生 403 的原因。</p>
<h3 id="4-4-4-404-Not-Found"><a href="#4-4-4-404-Not-Found" class="headerlink" title="4.4.4   404 Not Found"></a><strong>4.4.4</strong>   404 Not Found</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoprjbvpvj30ji06k74l.jpg"></p>
<p>服务器上无法找到请求的资源。除此之外，也可以在服务器端拒绝请求且不想说明理由时使用。</p>
<h2 id="4-5-5XX-服务器错误"><a href="#4-5-5XX-服务器错误" class="headerlink" title="4.5 5XX 服务器错误"></a><strong>4.5</strong> <strong>5XX</strong> 服务器错误</h2><h3 id="4-5-1-500-Internal-Server-Error"><a href="#4-5-1-500-Internal-Server-Error" class="headerlink" title="4.5.1    500 Internal Server Error"></a><strong>4.5.1</strong>    500 Internal Server Error</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopsjve7vj30im05zmxg.jpg"></p>
<p>服务器端在执行请求时发生了错误。也有可能是 Web 应用存在的 bug 或某些临时的故障。</p>
<h3 id="4-5-2-503-Service-Unavailable"><a href="#4-5-2-503-Service-Unavailable" class="headerlink" title="4.5.2 503 Service Unavailable"></a><strong>4.5.2</strong> <strong>503 Service Unavailable</strong></h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfopt237lnj30fe05nweq.jpg"></p>
<p>服务器暂时处于超负载或正在进行停机维护，现在无法 处理请求。如果事先得知解除以上状况需要的时间，最好写入 RetryAfter 首部字段再返回给客户端。</p>
<blockquote>
<p>状态码和状况的不一致</p>
<p>不少返回的状态码响应都是错误的，但是用户可能察觉不到这点。 </p>
<p>比如 Web 应用程序内部发生错误，状态码依然返回 200 OK，这种 情况也经常遇到。</p>
</blockquote>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/06/23/http-ReadNotes-02/">http_ReadNotes-02</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-06-23T13:19:02.000Z" itemprop="datePublished">Jun 23, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/http/">http</a>
</div>
    </div>
      
        <h1 id="III-HTTP-报文内的-HTTP-信息"><a href="#III-HTTP-报文内的-HTTP-信息" class="headerlink" title="III. HTTP 报文内的 HTTP 信息"></a>III. HTTP 报文内的 HTTP 信息</h1><h2 id="3-1-HTTP-报文"><a href="#3-1-HTTP-报文" class="headerlink" title="3.1 HTTP 报文"></a><strong>3.1</strong> <strong>HTTP</strong> 报文</h2><p>用于 HTTP 协议交互的信息被称为 <code>HTTP 报文</code>。</p>
<p>请求端(客户端)的 HTTP 报文叫做<code>请求报文</code>，响应端(服务器端)的叫做<code>响应报文</code>。 </p>
<p>HTTP 报文本身是由<u>多行(用 CR+LF 作换行符)数据构成的字符串文本</u>。</p>
<ul>
<li>报文首部</li>
<li>空行(CR+LF)</li>
<li>报文主体</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoo1ib7nej30ke06y74s.jpg"></p>
<h2 id="3-2-请求报文及响应报文的结构"><a href="#3-2-请求报文及响应报文的结构" class="headerlink" title="3.2 请求报文及响应报文的结构"></a><strong>3.2</strong> 请求报文及响应报文的结构</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoo27262wj30jz0a63zg.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoo2id0v1j30j60il0v3.jpg"></p>
<p>==请求行==<br> 包含用于请求的方法，请求 URI 和 HTTP 版本。 </p>
<p>==状态行==<br> 包含表明响应结果的状态码，原因短语和 HTTP 版本。 </p>
<p>==首部字段==</p>
<p>包含表示请求和响应的各种条件和属性的各类首部。</p>
<p>一般有 4 种首部: <u>通用首部</u>、<u>请求首部</u>、<u>响应首部</u>和<u>实体首部</u>。</p>
<p>其他<br> 可能包含 HTTP 的 RFC 里未定义的首部(Cookie 等)。</p>
<h2 id="3-3-编码提升传输速率"><a href="#3-3-编码提升传输速率" class="headerlink" title="3.3 编码提升传输速率"></a><strong>3.3</strong> 编码提升传输速率</h2><ul>
<li>在传输过程中通过编码提升传输速率。通过在传输时编码，能有效地处理大量的访问请求。</li>
<li>编码的操作需要计算机来完成，因此会消耗更多 的 CPU 等资源。</li>
</ul>
<h3 id="3-3-1-报文主体和实体主体的差异"><a href="#3-3-1-报文主体和实体主体的差异" class="headerlink" title="3.3.1 报文主体和实体主体的差异"></a><strong>3.3.1</strong> 报文主体和实体主体的差异</h3><ul>
<li><p>报文(<strong>message</strong>)</p>
<p>是 HTTP 通信中的基本单位，由 8 位组字节流(octet sequence， 其中 octet 为 8 个比特)组成，通过 HTTP 通信传输。</p>
</li>
<li><p>实体(<strong>entity</strong>) </p>
<p>作为请求或响应的有效载荷数据(补充项)被传输，其内容由实体首部和实体主体组成。</p>
</li>
<li><p>通常，<code>报文主体</code>等于<code>实体主体</code>。只有当传输中进行编码操作时，实体主体的内容发生变化，才导致它和报文主体产生差异。</p>
</li>
</ul>
<h3 id="3-3-2-压缩传输的内容编码"><a href="#3-3-2-压缩传输的内容编码" class="headerlink" title="3.3.2 压缩传输的内容编码"></a><strong>3.3.2</strong> 压缩传输的内容编码</h3><p><code>内容编码</code>指明应用在实体内容上的编码格式，并保持实体信息原样压缩。内容编码后的实体由客户端接收并负责解码。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoof07w9nj30kl0c4aap.jpg"></p>
<p>常用的内容编码有以下几种。</p>
<ul>
<li><strong>gzip</strong>(<strong>GNU zip</strong>)</li>
<li><strong>compress</strong>(<strong>UNIX</strong> 系统的标准压缩) </li>
<li><strong>deflate</strong>(<strong>zlib</strong>)</li>
<li><strong>identity</strong>(不进行编码)</li>
</ul>
<h3 id="3-3-3-分割发送的分块传输编码"><a href="#3-3-3-分割发送的分块传输编码" class="headerlink" title="3.3.3 分割发送的分块传输编码"></a><strong>3.3.3</strong> 分割发送的分块传输编码</h3><p>在 HTTP 通信过程中，请求的编码实体资源尚未全部传输完成之前， 浏览器无法显示请求页面。在传输大容量数据时，通过把数据分割成多块，能够让浏览器逐步显示页面。</p>
<p>这种把实体主体分块的功能称为<code>分块传输编码</code>(Chunked Transfer Coding)。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoojz6ogvj30lk0dct9l.jpg"></p>
<p>每一块都会用<strong>十六进制</strong>来标记块的大小，而实体主体的<strong>最后一块会使用“0(CR+LF)”来标记</strong>。</p>
<p>HTTP/1.1 中存在一种称为<code>传输编码(Transfer Coding)</code>的机制，它可以在通信时按某种编码方式传输，但只定义作用于分块传输编码中。</p>
<h2 id="3-4-发送多种数据的多部分对象集合"><a href="#3-4-发送多种数据的多部分对象集合" class="headerlink" title="3.4 发送多种数据的多部分对象集合"></a><strong>3.4</strong> 发送多种数据的多部分对象集合</h2><p><code>MIME</code>(Multipurpose Internet Mail Extensions，多用途因特网邮件扩展)机制</p>
<ul>
<li>允许邮件处理文本、图片、视频等多个不同类型的数据。例如，图片等二进制数据以 ASCII 码字符串编码的方式指明， 就是利用 MIME 来描述标记数据类型。而在 MIME 扩展中会使用一 种称为<code>多部分对象集合(Multipart)</code>的方法，来容纳多份不同类型的 数据。</li>
</ul>
<p>HTTP 协议中也采纳了多部分对象集合，发送的一份报文主体内可含有多类型实体。通常是在图片或文本文件等上传时使用。</p>
<p><strong>多部分对象集合包含的对象如下:</strong></p>
<ul>
<li><strong>multipart/form-data</strong><br>在 Web 表单文件上传时使用。 </li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=AaB03x  </span><br><span class="line">--AaB03x</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;field1&quot;</span><br><span class="line"> </span><br><span class="line">Joe Blow</span><br><span class="line">--AaB03x</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;pics&quot;; filename=&quot;file1.txt&quot; Content-Type: text/plain</span><br><span class="line"> </span><br><span class="line">...(file1.txt的数据)... --AaB03x--</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>multipart/byte ranges</strong></p>
<p>状态码 206(Partial Content，部分内容)响应报文包含了多个范 围的内容时使用。</p>
</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">206</span> Partial Content</span><br><span class="line"><span class="attribute">Date</span>: Fri, 13 Jul 2012 02:45:26 GMT</span><br><span class="line"><span class="attribute">Last-Modified</span>: Fri, 31 Aug 2007 02:02:20 GMT</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/byteranges; boundary=THIS_STRING_SEPARATES</span><br><span class="line">--THIS_STRING_SEPARATES</span><br><span class="line"><span class="attribute">Content-Type</span>: application/pdf Content-Range: bytes 500-999/8000</span><br><span class="line">...(范围指定的数据)... </span><br><span class="line">--THIS_STRING_SEPARATES Content-Type: application/pdf Content-Range: bytes 7000-7999/8000</span><br><span class="line">...(范围指定的数据)... </span><br><span class="line">--THIS_STRING_SEPARATES--</span><br></pre></td></tr></table></figure>

<ul>
<li>在 HTTP 报文中使用多部分对象集合时，需要在首部字段里加上 Content-type。</li>
<li>用 boundary 字符串来划分多部分对象集合指明的各类实体。</li>
<li>在 boundary 字符串指定的各个实体的起始行之前插入“–”标记(例如:- -AaB03x、–THIS_STRING_SEPARATES)</li>
<li>在多部分对象集合对 应的字符串的最后插入“–”标记(例如:–AaB03x–、– THIS_STRING_SEPARATES–)作为结束</li>
<li>多部分对象集合的每个部分类型中，都可以含有首部字段</li>
<li>可 以在某个部分中嵌套使用多部分对象集合。</li>
</ul>
<h2 id="3-5-获取部分内容的范围请求"><a href="#3-5-获取部分内容的范围请求" class="headerlink" title="3.5 获取部分内容的范围请求"></a><strong>3.5</strong> 获取部分内容的范围请求</h2><p><code>可恢复机制</code>——能从之前下载中断处恢复下载。→→要指定下载的实体范围。</p>
<p>指定范围发送的请求叫做<code>范围请求(Range Request)</code></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoouyt28xj30j70g3q4t.jpg"></p>
<p>byte 范围的指定形式如下：</p>
<p><strong>5001~10 000</strong> 字节</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Range</span>: bytes=5001-10000</span><br></pre></td></tr></table></figure>

<p>从 <strong>5001</strong> 字节之后全部的 </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Range</span>: bytes=5001-</span><br></pre></td></tr></table></figure>

<p>从一开始到 <strong>3000</strong> 字节和 <strong>5000~7000</strong> 字节的多重范围 </p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Range</span>: bytes=-3000, 5000-7000</span><br></pre></td></tr></table></figure>

<ul>
<li>针对范围请求，响应会返回状态码为 206 Partial Content 的响应报 文。</li>
<li>对于多重范围的范围请求，响应会在首部字段 Content- Type 标明 multipart/byteranges 后返回响应报文。</li>
<li>如果服务器端无法响应范围请求，则会返回状态码 200 OK 和完整的实体内容。</li>
</ul>
<h2 id="3-6-内容协商返回最合适的内容"><a href="#3-6-内容协商返回最合适的内容" class="headerlink" title="3.6 内容协商返回最合适的内容"></a><strong>3.6</strong> 内容协商返回最合适的内容</h2><p>当浏览器的默认语言为英语或中文，访问相同 URI 的 Web 页面时， 则会显示对应的英语版或中文版的 Web 页面。这样的机制称为<code>内容 协商(Content Negotiation)</code>。👇</p>
<p>客户端和服务器端就响应的资源内容进行交涉，然 后提供给客户端最为适合的资源。内容协商会以响应<u>资源的语言</u>、<u>字符集</u>、<u>编码方式</u>等作为判断的基准。</p>
<p>包含在请求报文中的某些首部字段(如下)就是判断的基准。</p>
<ul>
<li><strong>Accept</strong></li>
<li><strong>Accept-Charset</strong></li>
<li>**Accept-Encoding **</li>
<li>**Accept-Language **</li>
<li><strong>Content-Language</strong></li>
</ul>
<h4 id="内容协商技术の类型："><a href="#内容协商技术の类型：" class="headerlink" title="内容协商技术の类型："></a>内容协商技术の类型：</h4><ul>
<li>服务器驱动协商(<strong>Server-driven Negotiation</strong>)</li>
</ul>
<p>由服务器端进行内容协商。以请求的首部字段为参考，在服务器端自动处理。</p>
<p>但对用户来说，以浏览器发送的信息作为判定的依据，并不一定能筛选出最优内容。</p>
<ul>
<li>客户端驱动协商(<strong>Agent-driven Negotiation</strong>)</li>
</ul>
<p>由客户端进行内容协商的方式。用户从浏览器显示的可选项列表中手动选择。</p>
<p>还可以利用 JavaScript 脚本在 Web 页面上自动进行上述选 择。</p>
<p>比如按 OS 的类型或浏览器类型，自行切换成 PC 版页面或手机 版页面。</p>
<ul>
<li>透明协商(<strong>Transparent Negotiation</strong>)</li>
</ul>
<p>是服务器驱动和客户端驱动的结合体，是由服务器端和客户端各自进行内容协商的一种方法。</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/06/18/http-ReadNotes-01/">http_ReadNotes-01</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-06-18T06:16:55.000Z" itemprop="datePublished">Jun 18, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/http/">http</a>
</div>
    </div>
      
        <blockquote>
<p>web开发中可能会用到用到 HTTP 协议的各方面知识 の 工作：</p>
<ul>
<li>编写网络爬虫phyton程序</li>
<li>分析抓包数据</li>
<li>实现 HTTP 服务器</li>
<li>提供网站 REST API</li>
<li>修改后端定制框架</li>
</ul>
</blockquote>
<hr>
<h1 id="I-web及网络基础"><a href="#I-web及网络基础" class="headerlink" title="I. web及网络基础"></a>I. web及网络基础</h1><p>==HTTP    (HyperText Transfer Protocol）   超文本传输协议== </p>
<h2 id="1-1-HTTP-协议访问-Web"><a href="#1-1-HTTP-协议访问-Web" class="headerlink" title="1.1  HTTP 协议访问 Web"></a><strong>1.1</strong>  <strong>HTTP</strong> 协议访问 Web</h2><ul>
<li>Web 是建立在 HTTP 协议上通信的。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9e5n5837j30if080gm2.jpg"></p>
<blockquote>
<p>根据指定的URL，web浏览器从web服务器获取相应资源（resource），然后呈现在web页面上，实现这种功能的web浏览器is—-<code>客户端(client)</code>。</p>
</blockquote>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9e9fsd4wj30hq05474o.jpg"></p>
<blockquote>
<p>完成这一系列事件，需要遵循一种规则约定—-超文本传输协议 is <code>HTTP</code> Hyper Text Transfer Protocol。</p>
</blockquote>
<h2 id="1-2-WWW-构建技术"><a href="#1-2-WWW-构建技术" class="headerlink" title="1.2 WWW 构建技术"></a>1.2 WWW 构建技术</h2><ol>
<li><code>HTML</code> ： 把 <code>SGML</code>(Standard Generalized Markup Language，标准通用标记语言)  作为页面的文本标 记语言的 <code>HTML</code>(HyperText Markup Language，超文本标记语言);</li>
<li><code>HTTP</code> ：作为文档传递协议的 HTTP。</li>
<li><code>URL</code> ：指定文档所在地址- URL(Uniform Resource Locator，统一资源定位符)。</li>
</ol>
<h2 id="1-3网络基础-TCP-IP"><a href="#1-3网络基础-TCP-IP" class="headerlink" title="1.3网络基础  TCP/IP"></a>1.3网络基础  TCP/IP</h2><blockquote>
<p>通常使用的 网络(包括互联网)是在  <code>TCP/IP 协议族</code>的基础上运作的。而 HTTP 属于它内部的一个子集。</p>
</blockquote>
<h3 id="1-3-1-TCP-IP-协议族"><a href="#1-3-1-TCP-IP-协议族" class="headerlink" title="1.3.1 TCP/IP 协议族"></a><strong>1.3.1</strong> <strong>TCP/IP</strong> 协议族</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9en3wyyzj30hz08jglz.jpg"></p>
<p>图:<strong>TCP/IP</strong> 是互联网相关的各类协议族的总称</p>
<h3 id="1-3-2-TCP-IP-的分层管理"><a href="#1-3-2-TCP-IP-的分层管理" class="headerlink" title="1.3.2 TCP/IP 的分层管理"></a><strong>1.3.2</strong> <strong>TCP/IP</strong> 的分层管理</h3><p>TCP/IP 协议族按  层次  分为 4 层:</p>
<ul>
<li><code>应用层</code>：<ul>
<li>决定了向用户<u>提供应用服务时的通信活动</u>；</li>
<li>TCP/IP 协议族内预存了各类通用的应用服务。<br>如：<code>FTP</code>(File Transfer Protocol，文件传输协议)、<br><code>DNS</code>(Domain Name System，域名系统) 服务</li>
<li>HTTP 协议也处于该层。</li>
</ul>
</li>
<li><code>传输层</code> ：<ul>
<li>对上层应用层，<u>提供处于网络连接中的两台计算机之间的数据传输</u>。</li>
<li>两个性质不同的协议:<br><code>TCP</code>(Transmission Control Protocol，传输控制协议)<br><code>UDP</code>(User Data Protocol，用户数据报协议)。</li>
</ul>
</li>
<li><code>网络层</code> ：<ul>
<li>处理在网络上流动的数据包，<u>数据包是网络传输的最小数据单位</u>。</li>
<li>规定了<u>通过怎样的路径</u>(所谓的传输路线)到达对方计算机，并<u>把数据包传送给对方</u>。</li>
<li>与对方计算机之间<u>通过多台计算机或网络设备进行传输时</u>，–<u>在众多的选项内选择一条传输路线</u>。</li>
</ul>
</li>
<li><code>数据链路层</code> ：（网络接口层）<ul>
<li>处理连接网络的硬件部分，包括–<br><u>控制操作系统</u>、<br><u>硬件的设备驱动</u><br><code>NIC</code>(Network Interface Card，网络适配器，即网卡)<br><u>光纤等物理可见部分</u>(还包括连接器等一切传输媒介)。</li>
<li>硬件上的范畴均在链路层的作用范围之内。</li>
</ul>
</li>
</ul>
<blockquote>
<p>这样一来：要改变设计时，只需把变动的那层替换掉即可。</p>
<p>把各层之间的接口部分规划好之 后，每个层次内部的设计就能够自由改动了。</p>
</blockquote>
<h3 id="1-3-3-TCP-IP-通信传输流"><a href="#1-3-3-TCP-IP-通信传输流" class="headerlink" title="1.3.3 TCP/IP 通信传输流"></a><strong>1.3.3</strong> <strong>TCP/IP</strong> 通信传输流</h3><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9f2itcrej30i90e0wf5.jpg"></p>
<blockquote>
<p>发送端从应用层往下走，接收端则往应用层往上走。</p>
</blockquote>
<p>发出HTTP请求 </p>
<p>​    👇</p>
<p>TCP协议把HTTP 请求报文进行分割 ，打上标记序号、端口号</p>
<p>​    👇</p>
<p>IP 协议增加MAC 地址(作为<u>通信目的地</u>的 )后转发给链路层</p>
<p>​    👇</p>
<p>这样一来，发往网络的通信请求就准备齐全了。</p>
<p>​    👇</p>
<p>接收端的服务器在链路层接收到数据，按序往上层发送</p>
<p>​    👇</p>
<p>当传输到应用层，才算真正接收到由客端发送过来的 HTTP 请求👩</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9fbm9tolj30i80fvdh9.jpg"></p>
<blockquote>
<p>发送端在层与层之间传输数据时，每经过一层时必定会被打上一个==该层所属的首部信息==。</p>
<p>接收端在层与层传输数据时，每经过一层时会把对应的首部消去。</p>
<p>这种==把数据信息包装起来==的做法称为<code>封装</code>(encapsulate)。</p>
</blockquote>
<h2 id="1-4-IP、TCP-和-DNS-—与-HTTP-关系密切"><a href="#1-4-IP、TCP-和-DNS-—与-HTTP-关系密切" class="headerlink" title="1.4  IP、TCP 和 DNS —与 HTTP 关系密切"></a><strong>1.4</strong>  IP、TCP 和 DNS —与 <strong>HTTP</strong> 关系密切</h2><h3 id="1-4-1-负责传输的-IP-协议"><a href="#1-4-1-负责传输的-IP-协议" class="headerlink" title="1.4.1 负责传输的 IP 协议"></a><strong>1.4.1</strong> 负责传输的 <strong>IP</strong> 协议</h3><ul>
<li><p><code>IP 地址</code>  ：指明了节点被分配到的地址</p>
</li>
<li><p><code>MAC 地址</code>(Media Access Control Address) ：网卡所属的固定地址</p>
</li>
<li><p>IP 地址可以和 MAC 地址进行配对；IP 地址可变换，MAC 地址基本上不会更改。</p>
</li>
<li><p>IP 间的通信依赖 MAC 地址</p>
</li>
</ul>
<p>在网络上，通信的双方在同一局域网 (LAN)内的情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。</p>
<p>而在进行<u>中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标</u>。</p>
<p>这时，会采用 <code>ARP 协议</code>(Address Resolution Protocol)。</p>
<ul>
<li><p><code>ARP</code> 是用来  **<u>解析地址</u>**的协议，根据通信方 的 IP 地址就可以反查出对应的 MAC 地址。</p>
</li>
<li><p><code>路由选择(routing)</code> ：在到达通信目标前的中转过程中，那些计算机和路由器等网络设备只 能获悉很粗略的传输路线。这种机制称为路由选择(routing)</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9gfsicbwj30hh0g075q.jpg"></p>
<h3 id="1-4-2-确保可靠性的-TCP-协议"><a href="#1-4-2-确保可靠性的-TCP-协议" class="headerlink" title="1.4.2 确保可靠性的 TCP 协议"></a><strong>1.4.2</strong> 确保可靠性的 <strong>TCP</strong> 协议</h3><blockquote>
<p>TCP 位于传输层，提供可靠的字节流服务。</p>
</blockquote>
<ul>
<li><p><code>字节流服务</code>— 将大块数据分割成以报文段(segment)为单位的数据包进行管理。</p>
</li>
<li><p>TCP 协议为 了更容易传送大数据才把数据分割；</p>
</li>
<li><p>TCP 协议能够确认数据最终是否送达到对方： <code>三次握手(three-way handshaking)策略</code></p>
<ul>
<li>数据包送出去后，TCP会向对方确认是否成功送达；</li>
<li>握手过程使用：<ul>
<li>TCP 的标志(flag) </li>
<li>SYN(synchronize) </li>
<li>ACK(acknowledgement)。</li>
</ul>
</li>
</ul>
<p>SNY ➡️</p>
<p>​        ⬅️ SNY/ACK</p>
<p>ACK➡️   </p>
<p>​                    </p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9glwue5cj30hg09p3za.jpg"></p>
<h2 id="1-5-负责域名解析的-DNS-服务"><a href="#1-5-负责域名解析的-DNS-服务" class="headerlink" title="1.5 负责域名解析的 DNS 服务"></a>1.5 负责域名解析的 <strong>DNS</strong> 服务</h2><ul>
<li><p><code>DNS</code>(Domain Name System)提供<strong>域名</strong>到 IP 地址之间的<strong>解析服务</strong>。</p>
</li>
<li><p><strong><u>计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。</u></strong></p>
</li>
<li><p>用户通常使用<code>主机名</code>或<code>域名</code>来访问对方的计算机</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9h2hmrbjj30he0bbaay.jpg"></p>
<h2 id="1-6-各种协议与-HTTP-协议的关系"><a href="#1-6-各种协议与-HTTP-协议的关系" class="headerlink" title="1.6 各种协议与 HTTP 协议的关系"></a><strong>1.6</strong> 各种协议与 <strong>HTTP</strong> 协议的关系</h2><p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9h85ouxyj30ft0mswgr.jpg"></p>
<h2 id="1-7-URI-和-URL"><a href="#1-7-URI-和-URL" class="headerlink" title="1.7 URI 和 URL"></a><strong>1.7</strong> <strong>URI</strong> 和 <strong>URL</strong></h2><p><code>URI</code>  Uniform Resource Identifier   统一资源标识符</p>
<ul>
<li>由某个协议方案表示的资源的定位标识符。</li>
<li>协议方案是指  访问资源所使用的协议类型名称；采用 HTTP 协议时，协议方案就是 http。除此之外，还有 ftp、mailto、telnet、file 等；</li>
<li><code>URI</code> 用字符串标识某一互联网资源，而 <code>URL</code> 表示资源的地点(互联 网上所处的位置)。</li>
</ul>
<h3 id="URI-格式"><a href="#URI-格式" class="headerlink" title="URI 格式"></a><strong>URI</strong> 格式</h3><ul>
<li>绝对 URI </li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gf9icxnnjvj30g703twer.jpg"></p>
<blockquote>
<p>使用 http: 或 https: 等协议方案名获取访问资源时要指定协议类型。</p>
<p>不区分字母大小写，最后附一个冒号(:)。</p>
<p>也可使用 data: 或 javascript: 这类指定数据或脚本程序的方案名。</p>
</blockquote>
<h5 id="📟-登录信息-认证"><a href="#📟-登录信息-认证" class="headerlink" title="📟 登录信息(认证)"></a>📟 登录信息(认证)</h5><p>指定用户名和密码作为从服务器端获取资源时必要的登录信息(身份认证)。此项是可选项。</p>
<h5 id="✉️-服务器地址"><a href="#✉️-服务器地址" class="headerlink" title="✉️  服务器地址"></a>✉️  服务器地址</h5><p>使用绝对 URI 必须指定待访问的服务器地址。地址可以是类似 hackr.jp 这种 <code>DNS</code> 可解析的名称，或是 192.168.1.1 这类 <code>IPv4</code> 地址名，还可以是 [0:0:0:0:0:0:0:1] 这样用方括号括起来的 <code>IPv6</code> 地址名。</p>
<h5 id="🕰-服务器端口号"><a href="#🕰-服务器端口号" class="headerlink" title="🕰 服务器端口号"></a>🕰 服务器端口号</h5><p>指定服务器连接的网络端口号。此项也是可选项，若用户省略则自动 使用默认端口号。</p>
<h5 id="📑-带层次的文件路径"><a href="#📑-带层次的文件路径" class="headerlink" title="📑 带层次的文件路径"></a>📑 带层次的文件路径</h5><p>指定服务器上的文件路径来定位特指的资源。这与 UNIX 系统的文件目录结构相似。</p>
<h5 id="🔑-查询字符串"><a href="#🔑-查询字符串" class="headerlink" title="🔑 查询字符串"></a>🔑 查询字符串</h5><p>针对已指定的文件路径内的资源，可以使用查询字符串传入任意参 数。此项可选。</p>
<h5 id="🔫-片段标识符"><a href="#🔫-片段标识符" class="headerlink" title="🔫 片段标识符"></a>🔫 片段标识符</h5><p>使用片段标识符通常可标记出已获取资源中的子资源(文档内的某个位置)。但在 RFC 中并没有明确规定其使用方法。该项也为可选项。</p>
<blockquote>
<p>一些用来制定 HTTP 协议技术标准的文档，它们被称为<code>RFC</code>(Request for Comments，征求修正意见书)。</p>
<p>并不是所有的应用程序都符合 RFC</p>
<p>RFC 是 互联网的设计文档，要是不按照 RFC 标准执行，就有可能导致无法通信的状况。</p>
<p>基本 上客户端和服务器端都会以 RFC 为标准来实现 HTTP 协议。</p>
</blockquote>
<hr>
<h1 id="II-简单的-HTTP-协议"><a href="#II-简单的-HTTP-协议" class="headerlink" title="II.简单的 HTTP 协议"></a>II.简单的 HTTP 协议</h1><h2 id="2-1-HTTP-协议作用"><a href="#2-1-HTTP-协议作用" class="headerlink" title="2.1 HTTP 协议作用"></a>2.1 <strong>HTTP</strong> 协议作用</h2><p><strong>HTTP</strong> 协议用于客户端和服务器端之间的<code>通信</code></p>
<p>请求访问文本或图像等资源的一端称为<code>客户端</code>，而提供资源响应的一 端称为<code>服务器端</code>。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomjb1s01j30jx07zt9e.jpg"></p>
<p>两台计算机作为客户端和服务器端的<u>角色有可能会互换</u>。但就仅从一条通信路线来说，服务器端和客户端的角色是确定的，而用 HTTP 协议能够明确区分哪端是客户端，哪端是服务器端。</p>
<h2 id="2-2-How达成通信"><a href="#2-2-How达成通信" class="headerlink" title="2.2 How达成通信"></a><strong>2.2</strong> How达成通信</h2><p>通过<code>请求和响应的交换</code>达成通信</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfommtf5i8j30jk074q3k.jpg"></p>
<p>肯定是先从客户端开始建立通信的，服务器端在没有接收到请求之前不会发送响应。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomnk9uoij30k90acgmd.jpg"></p>
<p><strong>客户端发送给某个 HTTP 服务器端的请求报文中</strong>：</p>
<p><code>GET</code>—— 请求访问服务器的类型，称为方法 (method)。</p>
<p><code>字符串 /index.htm</code> ——-请求访问的资源对象， 也叫做请求 URI(request-URI)。</p>
<p> <code>HTTP/1.1</code>—— HTTP 的版本号，用来提示客户端使用的 HTTP 协议功能。</p>
<p>综合来看，这段请求内容的意思是:<u>请求访问某台 HTTP 服务器上的 /index.htm 页面资源。</u></p>
<p><code>请求报文</code>是由==请求方法==、==请求 URI==、==协议版本==、==可选的请求首部字段== 和内==容实体==构成的。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomrgipocj30k60azgm8.jpg"></p>
<p><strong>接收到请求的服务器，会将请求内容的处理结果以响应的形式返回：</strong></p>
<p> <code>HTTP/1.1</code> 表示服务器对应的 HTTP 版本。</p>
<p><code>200 OK</code> 表示请求的处理结果的状态码(status code)和原因短语(reason-phrase)。</p>
<p>下一行显示了创建响应的日期时间，是首部字段(header field)内的一个属性。</p>
<p>接着以一空行分隔，之后的内容称为<code>资源实体的主体</code>(entity body)。</p>
<p><code>响应报文</code>基本上由==协议版本==、==状态码(表示请求成功或失败的数字代码)==、==用以解释状态码的原因短语==、==可选的响应首部字段==以及==实体主体==构成。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomutu23fj30k20awaal.jpg"></p>
<h2 id="2-3-HTTP-是不保存状态的协议"><a href="#2-3-HTTP-是不保存状态的协议" class="headerlink" title="2.3 HTTP 是不保存状态的协议"></a><strong>2.3</strong> <strong>HTTP</strong> 是不保存状态的协议</h2><p>HTTP 是一种不保存状态，即<code>无状态(stateless)协议</code>。HTTP 协议自身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个级别，协议对于发送过的请求或响应都不做持久化处理。</p>
<p>这是为了更快地处理大量事务，确保协议的可伸缩性，而特意把 HTTP 协议设 计成如此简单的。</p>
<p>HTTP/1.1 虽然是无状态协议，但为了实现期望的保持状态功能，于 是引入了 <code>Cookie 技术</code>。有了 Cookie 再用 HTTP 协议通信，就可以管理状态了。</p>
<h2 id="2-4-请求-URI-定位资源"><a href="#2-4-请求-URI-定位资源" class="headerlink" title="2.4 请求 URI 定位资源"></a><strong>2.4</strong> 请求 <strong>URI</strong> 定位资源</h2><p>HTTP 协议使用 <strong>URI 定位互联网上的资源</strong>。正是因为 URI 的特定功能，在互联网上任意位置的资源都能访问到。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomywnmktj30js0em0u5.jpg"></p>
<p>当客户端请求访问资源而发送请求时，<strong>URI 需要将作为请求报文中的请求 URI 包含在内</strong>。</p>
<p><strong>指定请求 URI 的方式</strong>有很多。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfomzmqy4sj30jn0a5mxp.jpg"></p>
<p>如果不是访问特定资源而是对服务器本身发起请求，可以 用一个 * 来代替请求 URI。</p>
<p>下面这个例子是查询 HTTP 服务器端支持 的 HTTP 方法种类。</p>
<p>OPTIONS * HTTP/1.1</p>
<h2 id="2-5-告知服务器意图的-HTTP-方法"><a href="#2-5-告知服务器意图的-HTTP-方法" class="headerlink" title="2.5 告知服务器意图的 HTTP 方法"></a><strong>2.5</strong> 告知服务器意图的 <strong>HTTP</strong> 方法</h2><h3 id="GET-获取资源"><a href="#GET-获取资源" class="headerlink" title="GET :获取资源"></a><strong>GET</strong> :获取资源</h3><ul>
<li>==请求访问已被 URI 识别的资源==</li>
<li>指定的资源经服务器端解析后返回响应内容。</li>
<li>如果请求的资源是文本，那就保持原样返回;如果是像 CGI(Common Gateway Interface，通用网关接 口)那样的程序，则返回经过执行后的输出结果。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon42wnpfj30g7060mxc.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon4f24taj30lc09pq3m.jpg"></p>
<h3 id="POST-传输实体主体"><a href="#POST-传输实体主体" class="headerlink" title="POST:传输实体主体"></a><strong>POST</strong>:传输实体主体</h3><ul>
<li>虽然用 GET 方法也可以传输实体的主体，但一般不用 GET 方法进行传输，而是用 POST 方法。</li>
<li>虽说 POST 的功能与 GET 很相似，但 POST 的主要目的并不是获取响应的主体内容。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon6hk66ej30hd061dg0.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon6pxttjj30hs04omxg.jpg"></p>
<h3 id="PUT-传输文件"><a href="#PUT-传输文件" class="headerlink" title="PUT:传输文件"></a><strong>PUT</strong>:传输文件</h3><ul>
<li>就像 FTP 协议的文件上传一样，要求<u>在请求报文的主体中包含文件内容，然后保存到请求 URI 指定的位置</u>。</li>
<li>鉴于 HTTP/1.1 的 PUT 方法自身<u>不带验证机制</u>，任何人都可以上传文件 , 存在安全性问题，因此<u>一般的 Web 网站不使用该方法。</u></li>
<li>若配合 Web 应用程序的验证机制，或架构设计采用 REST(REpresentational State Transfer，表征状态转移)标准的同类 Web 网站，就可能会开放使用 PUT 方法。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon8qkhtdj30ki0cwt9w.jpg"></p>
<h3 id="HEAD-获得报文首部"><a href="#HEAD-获得报文首部" class="headerlink" title="HEAD:获得报文首部"></a><strong>HEAD</strong>:获得报文首部</h3><ul>
<li>HEAD 方法和 GET 方法一样，只是不返回报文主体部分。用于<u>确认 URI 的有效性</u>及<u>资源更新的日期时间</u>等。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfon9zhpr5j30is0893yv.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfona6xjqmj30i804igls.jpg"></p>
<h3 id="DELETE-删除文件"><a href="#DELETE-删除文件" class="headerlink" title="DELETE:删除文件"></a><strong>DELETE</strong>:删除文件</h3><ul>
<li><p>DELETE 方法用来删除文件，是与 PUT 相反的方法。DELETE 方法<u>按 请求 URI 删除指定的资源。</u></p>
</li>
<li><p>但是，HTTP/1.1 的 DELETE 方法本身和 PUT 方法一样<u>不带验证机制</u>，所以一般的 Web 网站也不使用 DELETE 方法。当配合 Web 应用 程序的验证机制，或遵守 REST 标准时还是有可能会开放使用的。</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonbcmqytj30jy09naaw.jpg"></p>
<h3 id="OPTIONS-询问支持的方法"><a href="#OPTIONS-询问支持的方法" class="headerlink" title="OPTIONS:询问支持的方法"></a><strong>OPTIONS</strong>:询问支持的方法</h3><ul>
<li><u>查询针对请求 URI 指定的资源支持的方法</u>。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonbvvjfej30jk070gly.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonc8192qj30iv05qaad.jpg"></p>
<h3 id="TRACE-追踪路径"><a href="#TRACE-追踪路径" class="headerlink" title="TRACE:追踪路径"></a><strong>TRACE</strong>:追踪路径</h3><ul>
<li><p><u>让 Web 服务器端将之前的请求通信环回给客户端的方法。</u></p>
</li>
<li><p>发送请求时，在 Max-Forwards 首部字段中填入数值，每经过一个服务器端就将该数字减 1，当数值刚好减到 0 时，就停止继续传输，最后接收到请求的服务器端则返回状态码 200 OK 的响应。</p>
</li>
<li><p>客户端通过 TRACE 方法可以查询发送出去的请求是怎样被加工修改 / 篡改的。因为，请求想要连接到源目标服务器可能会通过代理 中转，TRACE 方法就是用来确认连接过程中发生的一系列操作。</p>
<p>但是，TRACE 方法本来就不怎么常用，再加上它容易引发 XST(Cross-Site Tracing，跨站追踪)攻击，通常就更不会用到了。</p>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonecee5bj30j60cvmyl.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfoneu42hcj30ip041t8r.jpg"></p>
<h3 id="CONNECT-要求用隧道协议连接代理"><a href="#CONNECT-要求用隧道协议连接代理" class="headerlink" title="CONNECT:要求用隧道协议连接代理"></a><strong>CONNECT</strong>:要求用隧道协议连接代理</h3><ul>
<li><p>要求<u>在与代理服务器通信时建立隧道，实现用隧道协 议进行 TCP 通信。</u></p>
</li>
<li><p>主要使用 SSL(Secure Sockets Layer，安全套接 层)和 TLS(Transport Layer Security，传输层安全)协议把通信内容加密后经网络隧道传输。</p>
</li>
<li><p>CONNECT 方法的格式如下所示。 </p>
<ul>
<li>CONNECT 代理服务器名:端口号 HTTP版本</li>
</ul>
</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfong1l3d3j30jc0bi3zk.jpg"></p>
<h2 id="2-6-使用方法下达命令"><a href="#2-6-使用方法下达命令" class="headerlink" title="2.6 使用方法下达命令"></a><strong>2.6</strong> 使用方法下达命令</h2><ul>
<li><strong>向请求 URI 指定的资源发送请求报文时，采用称为方法的命令。</strong></li>
<li>方法的作用在于，<strong>可以指定请求的资源按期望产生某种行为</strong>。</li>
<li>方法中 有 <code>GET</code>、<code>POST</code> 和 <code>HEAD</code> 等。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonh7ww7ij30jq08vwf8.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonhxn0q6j30jt0fhtah.jpg"></p>
<h2 id="2-7-持久连接节省通信量"><a href="#2-7-持久连接节省通信量" class="headerlink" title="2.7 持久连接节省通信量"></a><strong>2.7</strong> 持久连接节省通信量</h2><h3 id="2-7-1-持久连接"><a href="#2-7-1-持久连接" class="headerlink" title="2.7.1 持久连接"></a><strong>2.7.1</strong> 持久连接</h3><p>持久连接(HTTP Persistent Connections，也称为 HTTP keep-alive 或 HTTP connection reuse)</p>
<p><strong>特点</strong>： 只要任意一端没有明确提出断开连接，则保持 TCP 连接状态。</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonjpakaaj30jr0h90ud.jpg"></p>
<p><strong>好处</strong>：</p>
<ul>
<li>减少 TCP 连接的重复建立和断开所造成的额外开销，减轻服务器端的负载。</li>
<li>使 HTTP 请求和响应能够更早地结束，Web 页面的显示速度提高。</li>
</ul>
<h3 id="2-7-2-管线化"><a href="#2-7-2-管线化" class="headerlink" title="2.7.2 管线化"></a><strong>2.7.2</strong> 管线化</h3><ul>
<li>久连接使得多数请求以管线化(pipelining)方式发送成为可能。</li>
<li>管线化技术使得 不用等待响应亦可直接发送下一个请求。</li>
<li>同时并行发送多个请求，而不需要一个接一个地等待响应。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonn8n2qrj30jr09p752.jpg"></p>
<h3 id="2-8-使用-Cookie-的状态管理"><a href="#2-8-使用-Cookie-的状态管理" class="headerlink" title="2.8 使用 Cookie 的状态管理"></a><strong>2.8</strong> 使用 <strong>Cookie</strong> 的状态管理</h3><p>HTTP 是无状态协议，无法根据之前的状态进行本次的请求处理。不保存状态，减少服务器的 CPU 及内存资源的消耗。</p>
<p><code>Cookie 技术</code>通过==在请求和响应报文中写入 Cookie 信息来控制客户端的状态==。</p>
<ul>
<li>根据从服务器端发送的响应报文内的 Set-Cookie 的首部字段信息，通知客户端保存 Cookie。</li>
<li>当下次客户端再往该服务器发送请求时，客户端会自动在请求报文中加入 Cookie 值后发送出去。</li>
<li>服务器端发现客户端发送过来的 Cookie 后，会去检查究竟是从哪一个客户端发来的连接请求，然后对比服务器上的记录，最后得到之前的状态信息。</li>
</ul>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonvunolbj30j90ah0te.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gfonwajvvej30j7093wf1.jpg"></p>
<p><strong>HTTP 请求报文和响应报文的内容:</strong></p>
<ol>
<li><p>请求报文(没有 <strong>Cookie</strong> 信息的状态)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/reader/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: hackr.jp </span><br><span class="line">*首部字段内没有Cookie的相关信息</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="2">
<li><p>响应报文(服务器端生成 <strong>Cookie</strong> 信息)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span>: Thu, 12 Jul 2012 07:12:20 GMT</span><br><span class="line"><span class="attribute">Server</span>: Apache</span><br><span class="line">&lt;Set-Cookie: sid=1342077140226724; path=/; expires=Wed, 10-Oct-12 07:12:20 GMT&gt;</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain; charset=UTF-8</span><br></pre></td></tr></table></figure>



</li>
</ol>
<ol start="3">
<li><p>请求报文(自动发送保存着的 <strong>Cookie</strong> 信息)</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/image/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: hackr.jp</span><br><span class="line"><span class="attribute">Cookie</span>: sid=1342077140226724</span><br></pre></td></tr></table></figure>





</li>
</ol>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/05/03/JSPro-ReadNotes-chap5/">JS高级_ReadNotes-chap5</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-05-03T12:09:27.000Z" itemprop="datePublished">May 3, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/JavaScript/">JavaScript</a>
</div>
    </div>
      
        <blockquote>
<p>ECMAScript中，<code>引用类型</code>是一种数据结构，用于将数据和功能组织在一起。–（<code>类</code>）</p>
<p>引用类型有时也被称为<code>对象定义</code>，—描述的是<u>一类对象所具有的属性和方法</u>。</p>
<p><code>对象</code>是某个特定引用类型的<code>实例</code>。new一下~~</p>
</blockquote>
<h1 id="I-Object类型"><a href="#I-Object类型" class="headerlink" title="I Object类型"></a>I Object类型</h1><p>在应用程序中，储存和传递数据。</p>
<h4 id="创建Object实例："><a href="#创建Object实例：" class="headerlink" title="创建Object实例："></a>创建Object实例：</h4><ol>
<li>使用Object构造函数 ：var person = new Object();   = = var person = { }</li>
<li>使用对象字面量： var person = { name : “Nicholas” , age : “21” }</li>
</ol>
<p><code>表达式上下文 expression context</code>  该上下文期待一个值（表达式）</p>
<p><code>语句上下文 statement context</code>  if条件语句等</p>
<p>※ ==在通过对象字面量定义对象时，不会调用Object构造函数==。</p>
<p>※ 对象字面量是向函数传递大量参数的首选： 函数传参时，对必须值使用命名参数，用对象字面量封装多个参数。</p>
<h4 id="访问对象属性："><a href="#访问对象属性：" class="headerlink" title="访问对象属性："></a>访问对象属性：</h4><p>点表示法：  alert(person.name);</p>
<p>方括号表示法： alert(person[‘name’]);</p>
<p>※ 方括号优势：</p>
<ul>
<li>通过变量访问属性 ———</li>
</ul>
<p>​                var prototypeName = “name”;</p>
<p>​                alert(person[prototypeName]);</p>
<ul>
<li><p>引用容易引起语法错误的字符、关键字或保留字</p>
<p>​     person[“first name”] = “Nicholas”</p>
</li>
</ul>
<h1 id="II-Array-类型"><a href="#II-Array-类型" class="headerlink" title="II  Array 类型"></a>II  Array 类型</h1><p>ECMAScript 数组的每一项都可以保存任何类型的数据。</p>
<p>ECMAScript 数组的大小是可以动态调整的。</p>
<h4 id="创建数组："><a href="#创建数组：" class="headerlink" title="创建数组："></a>创建数组：</h4><ol>
<li>使用Array构造函数：  –new可以省略<br>var colors = new Array(20);    20是length<br>var colors = new Array(“red”, “blue”, “green”);  直接向构造函数传递参数</li>
</ol>
<ol start="2">
<li>使用数组字面量：<br>var colors = [“red”, “blue”, “green”]<br>var colors = [ ]; </li>
</ol>
<h4 id="读取和设置数组的值："><a href="#读取和设置数组的值：" class="headerlink" title="读取和设置数组的值："></a>读取和设置数组的值：</h4><p>alert(colors[0]);</p>
<p>colors[2]=”black”;   //修改第三项</p>
<p>colors[3] =”yellow”;   //新增第四项</p>
<h4 id="数组的length属性："><a href="#数组的length属性：" class="headerlink" title="数组的length属性："></a>数组的length属性：</h4><p>可读可写—–可以移除或添加数组末尾的项。—-改变数组长度</p>
<p>数组最后一个索引为length-1</p>
<p><code>colors[colors.length] = &quot;black&quot;;</code>    //在末尾添加black色</p>
<h2 id="1-检测数值"><a href="#1-检测数值" class="headerlink" title="1. 检测数值"></a>1. 检测数值</h2><p>传统的instanceof操作符的问题—-假定只有一个全局执行环境，不适合多框架的开发环境</p>
<p>↓</p>
<h5 id="Array-isArray"><a href="#Array-isArray" class="headerlink" title="Array.isArray( )"></a><code>Array.isArray( )</code></h5><p>–最终确定某个值是不是数组，不论他是在哪个执行环境创建的。</p>
<h2 id="2-转换方法"><a href="#2-转换方法" class="headerlink" title="2. 转换方法"></a>2. 转换方法</h2><p>所有对象都有：<code>toLocalString()</code> , <code>toString()</code> , <code>valueOf()</code>  方法</p>
<p>↓</p>
<p>调用<code>valueOf()</code> 返回数组本身</p>
<p>调用 <code>toString()</code>  返回的数组中的每个值都是字符串  </p>
<p>调用<code>toLocalString()</code> 经常返回上述相同的值，不一定。</p>
<p>↓</p>
<p>还可使用<code>join()</code> 来使用其他的分隔符，join默认逗号分隔符。</p>
<h2 id="3-栈方法"><a href="#3-栈方法" class="headerlink" title="3. 栈方法"></a>3. 栈方法</h2><p><code>栈</code>—– 一种LIFO（last-In-First-Out）的数据结构</p>
<h5 id="push"><a href="#push" class="headerlink" title="push()"></a><code>push()</code></h5><p>–推入 : 接受任意数量参数，添加到数组末尾，<strong>返回新数组长度</strong></p>
<h5 id="pop"><a href="#pop" class="headerlink" title="pop()"></a><code>pop()</code></h5><p>–弹出 ：从数组末尾移除最后一项，<strong>返回移除的项</strong></p>
<h2 id="4-队列方法"><a href="#4-队列方法" class="headerlink" title="4. 队列方法"></a>4. 队列方法</h2><p><code>队列</code>—-一种FIFO（First-In-First-Out）的数据结构。</p>
<h5 id="shift"><a href="#shift" class="headerlink" title="shift()"></a><code>shift()</code></h5><ul>
<li>移除数组中第一项，<strong>返回移除的项</strong>   →  与push()相结合，就是队列的使用</li>
</ul>
<h5 id="unshift"><a href="#unshift" class="headerlink" title="unshift()"></a><code>unshift()</code></h5><ul>
<li>在数组前端添加任意项，<strong>返回新数组长度</strong>   →  与pop()相结合</li>
</ul>
<h2 id="5-重排序方法"><a href="#5-重排序方法" class="headerlink" title="5. 重排序方法"></a>5. 重排序方法</h2><h5 id="reverse"><a href="#reverse" class="headerlink" title="reverse()"></a><code>reverse()</code></h5><ul>
<li>—- 翻转数组</li>
</ul>
<h5 id="sort"><a href="#sort" class="headerlink" title="sort()"></a><code>sort()</code></h5><ul>
<li><p>按升序排列数组想  ， 该方法会调用每个数组项的toString()转型，==比较字符串==，</p>
</li>
<li><p>会接受一个比较函数作为参数，通过比较：-1，0，1 确定顺序</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compare</span> (<span class="params">value1,value2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (value1 &lt; value2)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> <span class="keyword">if</span> (value1 &gt; value2) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> values =[<span class="number">10</span>,<span class="number">1</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">5</span>];</span><br><span class="line">value.sort(compare);</span><br><span class="line">alert(values);  <span class="comment">//  0,1,5,10,15</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//按降序只要调整-1 和1 的位置就行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数值类型用简易比较函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compare</span> (<span class="params">value1,value2</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> value2 - value1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-操作方法"><a href="#6-操作方法" class="headerlink" title="6. 操作方法"></a>6. 操作方法</h2><h5 id="concat"><a href="#concat" class="headerlink" title="concat()"></a><code>concat()</code></h5><ul>
<li><p>基于当前数据中的所有项创建一个新数组。</p>
</li>
<li><p>先创建一个数组的副本，将接收到的参数添加至末尾，最后返回新构建的数组。</p>
</li>
</ul>
<h5 id="slice"><a href="#slice" class="headerlink" title="slice()"></a><code>slice()</code></h5><ul>
<li>基于当前数组中的一个或多个项创建新数组。 </li>
<li>接受一个或两个参数，返回项的起始和结束位置，不包括结束位置；只有一个参数，到数组末尾</li>
<li>不影响原始数组</li>
<li>若参数为负数，则加上数组长度后再计算</li>
</ul>
<h5 id="splice"><a href="#splice" class="headerlink" title="splice()"></a><code>splice()</code></h5><ul>
<li>删除—2个参数：要删除的第一项 ， 要删除的项数</li>
<li>插入—3个参数，起始位置， 0（要要删除的项数），要插入的任意数量的项</li>
<li>替换—3个参数，起始位置，要删除的项数，要插入的任意数量的项</li>
</ul>
<h2 id="7-位置方法"><a href="#7-位置方法" class="headerlink" title="7. 位置方法"></a>7. 位置方法</h2><h5 id="indexOf"><a href="#indexOf" class="headerlink" title="indexOf()"></a><code>indexOf()</code></h5><ul>
<li>接收2个参数：要查找的项， 查找起点索引号</li>
<li>从数组开头向后查找</li>
<li>返回查找项在数组中的位置，没找到返回-1</li>
<li>必须是严格相等 ===</li>
</ul>
<h5 id="lastIndextOf"><a href="#lastIndextOf" class="headerlink" title="lastIndextOf()"></a><code>lastIndextOf()</code></h5><ul>
<li>接收2个参数：要查找的项， 查找起点索引号</li>
<li>从数组末尾向前查找</li>
<li>返回查找项在数组中的位置，没找到返回-1</li>
<li>必须是严格相等 ===</li>
</ul>
<h2 id="8-迭代方法"><a href="#8-迭代方法" class="headerlink" title="8. 迭代方法"></a>8. 迭代方法</h2><p>每个方法都是：接收2个参数：要在每一项上运行的函数，(可选)运行该函数的作用域对象（影响this的值）；</p>
<p>传入的函数接收3个参数：数组项的值item，该项的位置index，数组对象本身array</p>
<h5 id="every"><a href="#every" class="headerlink" title="every()"></a><code>every()</code></h5><ul>
<li>在每一项运行传入的函数，该函数每一项都返回true，则返回true。</li>
</ul>
<h5 id="filter"><a href="#filter" class="headerlink" title="filter()"></a><code>filter()</code></h5><ul>
<li>在每一项运行传入的函数，把该函数返回true的项组成数组并返回。</li>
</ul>
<h5 id="forEach"><a href="#forEach" class="headerlink" title="forEach()"></a><code>forEach()</code></h5><ul>
<li>在每一项运行传入的函数，没有返回值。</li>
</ul>
<h5 id="map"><a href="#map" class="headerlink" title="map()"></a><code>map()</code></h5><ul>
<li>在每一项运行传入的函数，把该函数在每一项上调用的结果组成数组并返回。</li>
</ul>
<h5 id="some"><a href="#some" class="headerlink" title="some()"></a><code>some()</code></h5><ul>
<li>在每一项运行传入的函数，该函数对任意项返回true，则返回true。</li>
</ul>
<h2 id="9-归并方法"><a href="#9-归并方法" class="headerlink" title="9. 归并方法"></a>9. 归并方法</h2><p>迭代数组中的所有项，构建一个最终返回的值。</p>
<p>都接收2个参数：在每项上调用的函数， （可选）作为归并基础的初始值</p>
<p>传入的函数接收4个参数： 前一个值prev、当前值cur、项的索引index、数组对象array</p>
<h5 id="reduce"><a href="#reduce" class="headerlink" title="reduce()"></a><code>reduce()</code></h5><ul>
<li>从数组第一项开始遍历</li>
</ul>
<h5 id="reduceRight"><a href="#reduceRight" class="headerlink" title="reduceRight()"></a><code>reduceRight()</code></h5><ul>
<li>从数组最后一项开始遍历</li>
</ul>
<h1 id="III-Date类型"><a href="#III-Date类型" class="headerlink" title="III Date类型"></a>III Date类型</h1><h5 id="Date-parse"><a href="#Date-parse" class="headerlink" title="Date.parse()"></a><code>Date.parse()</code></h5><ul>
<li><p>接收一个表示日期的字符串参数，返回相应日期<strong>毫秒数</strong></p>
</li>
<li><p>传入字符串不能表示日期，则返回NaN</p>
<p>var someDate = new Date(Date.parse(“May 25, 2004”));<br>其实后台会自动调用Date.parse()</p>
</li>
</ul>
<h5 id="Date-UTC"><a href="#Date-UTC" class="headerlink" title="Date.UTC()"></a><code>Date.UTC()</code></h5><ul>
<li>接收的参数格式为： 年，月（基于0），日，时，分，秒  –前两个必填</li>
</ul>
<h5 id="Date-now"><a href="#Date-now" class="headerlink" title="Date.now()"></a><code>Date.now()</code></h5><ul>
<li>返回调用该方法时的毫秒数</li>
<li>var start =  +new Date();    使用+操作符 可以获取时间戳，达到同样效果</li>
</ul>
<h2 id="1-继承的方法"><a href="#1-继承的方法" class="headerlink" title="1. 继承的方法"></a>1. 继承的方法</h2><p>toLocalString()  和 toString() 的返回值问题</p>
<h2 id="2-日期格式化方法"><a href="#2-日期格式化方法" class="headerlink" title="2. 日期格式化方法"></a>2. 日期格式化方法</h2><h5 id="toDateString"><a href="#toDateString" class="headerlink" title="toDateString"></a><code>toDateString</code></h5><ul>
<li>以特定于现实的格式显示：星期、月、日、年</li>
</ul>
<h5 id="toTimeString"><a href="#toTimeString" class="headerlink" title="toTimeString"></a><code>toTimeString</code></h5><ul>
<li>以特定于现实的格式显示：时、分、秒、时区</li>
</ul>
<h5 id="toLocalDateString"><a href="#toLocalDateString" class="headerlink" title="toLocalDateString"></a><code>toLocalDateString</code></h5><ul>
<li>以特定于地区的格式显示：星期、月、日、年</li>
</ul>
<h5 id="toLocalTimeString"><a href="#toLocalTimeString" class="headerlink" title="toLocalTimeString"></a><code>toLocalTimeString</code></h5><ul>
<li>以特定于地区的格式显示：时、分、秒、时区</li>
</ul>
<h5 id="toUTCString"><a href="#toUTCString" class="headerlink" title="toUTCString"></a><code>toUTCString</code></h5><ul>
<li>以特定于现实的格式显示：完整的UTC日期</li>
</ul>
<h2 id="3-日期-时间组件方法"><a href="#3-日期-时间组件方法" class="headerlink" title="3. 日期/时间组件方法"></a>3. 日期/时间组件方法</h2><h1 id="IV-RegExp类型"><a href="#IV-RegExp类型" class="headerlink" title="IV RegExp类型"></a>IV RegExp类型</h1><p>正则表达式的匹配模式：</p>
<ul>
<li>g ：全局模式</li>
<li>i ：不区分大小写</li>
<li>m ：多行模式</li>
</ul>
<p>正则表达式中的元字符：</p>
<p>(     [    {    \    ^    $    |    )    ?    *    +    .    }    ]</p>
<p>–所有元字符都必须转义。</p>
<p>定义：</p>
<ul>
<li><p>字面量方式： var pattern = /·······/g</p>
</li>
<li><p>RegExp构造函数：<br>接收2个参数： 要匹配的字符串模式，可选的标志字符串</p>
<p>var pattern = / [bc]at/i ;</p>
<p>var pattern = new RegExp (“ [bc]at “ , “ i “) ;</p>
<p>接收的这2个参数都是字符串，在一些情况下要对其进行双重转义。</p>
<table>
<thead>
<tr>
<th>字面量模式</th>
<th>等价的字符串</th>
</tr>
</thead>
<tbody><tr>
<td><code>/\[bc\]at/</code></td>
<td><code>&quot;\\[bc\\]at&quot;</code></td>
</tr>
<tr>
<td><code>/\.at/</code></td>
<td><code>&quot;\\.at&quot;</code></td>
</tr>
<tr>
<td><code>/name\/age/</code></td>
<td><code>&quot;name\\/age&quot;</code></td>
</tr>
<tr>
<td><code>/\d.\d&#123;1,2&#125;/</code></td>
<td><code>&quot;\\d.\\d&#123;1,2&#125;&quot;</code></td>
</tr>
<tr>
<td><code>/\w\\hello\\123/</code></td>
<td><code>&quot;\\w\\\\hello\\\\123&quot;</code></td>
</tr>
<tr>
<td><code>/\n/</code></td>
<td><code>&quot;\\\\&quot;</code></td>
</tr>
</tbody></table>
</li>
</ul>
<p>在ECMAScript3：</p>
<ul>
<li>正则表达式字面量始终会共享一个RegExp实例</li>
<li>用构造函数创建的每个新RegExp实例都是一个新实例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> re = <span class="literal">null</span>,</span><br><span class="line">    i;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">  re = <span class="regexp">/cat/g</span>;</span><br><span class="line">  re.test(<span class="string">&quot;catastrophe&quot;</span>);  <span class="comment">//第二次迭代时调用test会失败，这里只有一个RegExp实例，</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</span><br><span class="line">  re = <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&quot;cat&quot;</span> , <span class="string">&quot;g&quot;</span>);</span><br><span class="line">  re.test(<span class="string">&quot;catastrophe&quot;</span>); <span class="comment">//每次迭代都会创建新的RegExp实例，每调用都会返回true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="1-RegExp实例类型"><a href="#1-RegExp实例类型" class="headerlink" title="1. RegExp实例类型"></a>1. RegExp实例类型</h2><p><code>global</code> —-布尔值。是否设置g标志</p>
<p><code>ignoreCase</code>  —-布尔值。是否设置i标志</p>
<p><code>lastIndex  </code> —-整数。开始搜索下一个匹配项的字符位置，从0算起</p>
<p><code>multiline</code>  —-布尔值。是否设置m标志</p>
<p><code>source</code>  —-正则表达式的字符串表示，按字面量形式，而非构造函数中的字符串模式返回</p>
<h2 id="2-RegExp实例方法"><a href="#2-RegExp实例方法" class="headerlink" title="2. RegExp实例方法"></a>2. RegExp实例方法</h2><h5 id="exec"><a href="#exec" class="headerlink" title="exec( )"></a><code>exec( )</code></h5><p>RegExp对象的主要方法—exec( )—专门为捕获组设计的。</p>
<ul>
<li>接受一个参数，–要应用模式的字符串。</li>
<li>返回包含第一个匹配项信息的数组。没有则返回null</li>
<li>返回的数组时Array的实例，且还包含，index和input属性</li>
</ul>
<h2 id="3-RegExp构造函数属性"><a href="#3-RegExp构造函数属性" class="headerlink" title="3. RegExp构造函数属性"></a>3. RegExp构造函数属性</h2><h2 id="4-模式的局限性"><a href="#4-模式的局限性" class="headerlink" title="4.模式的局限性"></a>4.模式的局限性</h2><h1 id="V-Function-类型"><a href="#V-Function-类型" class="headerlink" title="V Function 类型"></a>V Function 类型</h1><p>每个函数都是Function类型的实例，具有属性和方法。</p>
<p>==函数名 实际上是指向函数对象的指针，不会与某个函数绑定。==</p>
<p>==一个函数可能由多个名字。==</p>
<p>==使用不带括号的函数名，不是调用函数，而是访问指针==</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">num1, num2</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num1+num2;</span><br><span class="line">&#125;</span><br><span class="line">alert sum(<span class="number">10</span>,<span class="number">20</span>);  <span class="comment">//30</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> anotherSum = sum;</span><br><span class="line">alert anotherSum(<span class="number">10</span>,<span class="number">20</span>);  <span class="comment">//30</span></span><br><span class="line"></span><br><span class="line">sum = <span class="literal">null</span>;</span><br><span class="line">alert anotherSum(<span class="number">10</span>,<span class="number">20</span>);  <span class="comment">//30    即使让sum与函数断绝关系，仍可以正常调用函数anotherSum()</span></span><br></pre></td></tr></table></figure>

<p>函数定义：</p>
<ul>
<li><p>函数声明法： function sum (num1, num2) {  return num1 + num2 }</p>
</li>
<li><p>函数表达式:    var sum = function (num1, num2) {  return num1 + num2 } ;   ☞这里的分号就像声明其他的变量的格式一样</p>
</li>
<li><p>Function构造函数（不推荐）</p>
</li>
</ul>
<h2 id="1-没有重载（深入）"><a href="#1-没有重载（深入）" class="headerlink" title="1. 没有重载（深入）"></a>1. 没有重载（深入）</h2><p>后面的函数会覆盖前面的函数—-函数名只是指针。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addSomeNumber</span> (<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num +<span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addSomeNumber</span> (<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num +<span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = addSomeNumber(<span class="number">100</span>);  <span class="comment">//300</span></span><br><span class="line"></span><br><span class="line">↓</span><br><span class="line">↓</span><br><span class="line">↓</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> addSomeNumber =<span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num +<span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line">addSomeNumber =<span class="function"><span class="keyword">function</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> num +<span class="number">200</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = addSomeNumber(<span class="number">100</span>);  <span class="comment">//300</span></span><br></pre></td></tr></table></figure>



<h2 id="2-函数声明于函数表达式"><a href="#2-函数声明于函数表达式" class="headerlink" title="2. 函数声明于函数表达式"></a>2. 函数声明于函数表达式</h2><p>预解析问题</p>
<p>↓</p>
<p>解析器会率先读取函数声明（函数声明提升–function declaration hoisting）</p>
<h2 id="3-作为值的函数"><a href="#3-作为值的函数" class="headerlink" title="3. 作为值的函数"></a>3. 作为值的函数</h2><p>函数可以作为值来调用，因为函数名本身就是变量。</p>
<ul>
<li>把一个函数传递给另一个函数 （可以传进去）</li>
<li>将一个函数作为另一个函数的结果返回  （也可以return出来）</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">callSomeFunction</span>(<span class="params">someFUnction, someArguments</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> someFUnction(someArguments);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createComparisonFuncion</span>(<span class="params">propertyName</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">object1, object2</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> value1 = object1[propertyName];</span><br><span class="line">    <span class="keyword">var</span> value2 = object2[propertyName];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(value1 &lt; value2)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (value1 &gt; value2)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> =;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = [&#123;<span class="attr">name</span>:<span class="string">&quot;Nicholas&quot;</span>, <span class="attr">age</span>:<span class="number">28</span>&#125;, &#123;<span class="attr">name</span>:<span class="string">&quot;Greg&quot;</span>, <span class="attr">age</span>:<span class="number">29</span>&#125;];</span><br><span class="line"></span><br><span class="line">data.sort(createComparisonFunction(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">alert(data[<span class="number">0</span>].name);   <span class="comment">//Nicholas</span></span><br><span class="line"></span><br><span class="line">data.sort(createComparisonFunction(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">alert(data[<span class="number">1</span>].name);   <span class="comment">//Greg</span></span><br></pre></td></tr></table></figure>



<h2 id="4-函数内部属性"><a href="#4-函数内部属性" class="headerlink" title="4. 函数内部属性"></a>4. 函数内部属性</h2><p>函数内部有两个特殊的对象： <code>arguments</code>    <code>this</code></p>
<p>arguments 对象有个 <code>callee</code>属性， 他是一个指针，指向拥有这个arguments对象的函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//递归函数中的阶乘</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">num</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(num&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> num * <span class="built_in">arguments</span>.callee(num<span class="number">-1</span>);   <span class="comment">//消除耦合</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> trueFactorial = factorial;  <span class="comment">//获得factorial函数指针</span></span><br><span class="line"></span><br><span class="line">factorial = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;  <span class="comment">//factorial变为0， 但这与trueFactorial无关</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">alert(trueFactorial(<span class="number">5</span>)) ; <span class="comment">//120</span></span><br><span class="line">alert(factorial(<span class="number">5</span>));  <span class="comment">//0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//若没有用arguments.callee消除耦合，那么trueFactorial会返回0</span></span><br></pre></td></tr></table></figure>



<p>关于<code>this</code>：</p>
<p>==函数名字仅仅是包含指针的一个变量而已，即使在不同环境中执行，全局的sayColor()函数和obj.sayColor()指向的仍然是同一个函数。==</p>
<p><code>caller</code>属性–其中保存着调用当前函数的函数的引用，如果是在全局作用域中调用当前函数，他的值为null。</p>
<h2 id="5-函数属性和方法"><a href="#5-函数属性和方法" class="headerlink" title="5. 函数属性和方法"></a>5. 函数属性和方法</h2><h5 id="每个函数都包含两个属性："><a href="#每个函数都包含两个属性：" class="headerlink" title="每个函数都包含两个属性："></a>每个函数都包含两个属性：</h5><p><code>length</code>     –函数希望接受的命名参数的个数</p>
<p><code>prototype </code>  –是保存所有实例和方法的真实存在。此属性不可枚举，用for-in 无法发现</p>
<h5 id="每个函数都包含两个非继承而来的方法："><a href="#每个函数都包含两个非继承而来的方法：" class="headerlink" title="每个函数都包含两个非继承而来的方法："></a>每个函数都包含两个非继承而来的方法：</h5><p><code>apply()</code>  接受两个参数， 运行函数的作用域，参数数组（可以是Array实例，也可是arguments对象）</p>
<p><code>call()</code>  :  接受两个参数， 运行函数的作用域，参数的一一列举</p>
<p>==apply( ) 和call( )   能够扩充函数赖以运行的作用域==  —-改变this指向—使对象不需要与方法有任何耦合关系</p>
<p><code>bind()</code>   创建一个函数的实例，其this的值会被绑定到传给bind()的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.color = <span class="string">&quot;red&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> o =&#123;<span class="attr">color</span>: <span class="string">&quot;blue&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  alert(<span class="built_in">this</span>.color);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> objectSayColor = sayColor.bind(o);      <span class="comment">//这里this值变为o</span></span><br><span class="line">objectSayColor();   <span class="comment">//blue</span></span><br></pre></td></tr></table></figure>



<h1 id="VI-基本包装类型"><a href="#VI-基本包装类型" class="headerlink" title="VI 基本包装类型"></a>VI 基本包装类型</h1><p>没读取一个基本类型值时，后台就会相应创建一个基本包装类型的对象，让我们可以调用一些方法来操作他们。</p>
<p>步骤：</p>
<p>创建一个实例</p>
<p>↓</p>
<p>在实力上调用指定的方法</p>
<p>↓</p>
<p>销毁这个实例</p>
<ul>
<li><p>引用类型与基本包装类型 主要区别：  对象生存期。</p>
<ul>
<li>new出来的引用实例：在执行流离开当前作用域之前一直保存在内存中。</li>
<li>自动创建的基本包装类型对象：只存在于一行代码执行瞬间，然后被立即销毁。</li>
</ul>
</li>
<li><p>对基本包装类型的实例调用typeof—-返回object</p>
</li>
<li><p>所有基本包装类型的对象在转换为布尔值类型是值都是true</p>
</li>
<li><p>new出来的构造函数和直接调用的同名转型函数是不一样滴~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> value = <span class="number">25</span>;</span><br><span class="line"><span class="keyword">var</span> number = <span class="built_in">Number</span>(value);   <span class="comment">//转型函数--保存的是值</span></span><br><span class="line">alert(<span class="keyword">typeof</span> number) ;       <span class="comment">//number</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="built_in">Number</span>(value);    <span class="comment">//构造函数 --保存的是对象实例</span></span><br><span class="line">alert(<span class="keyword">typeof</span> obj);    <span class="comment">//object</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h2 id="1-Boolean类型"><a href="#1-Boolean类型" class="headerlink" title="1. Boolean类型"></a>1. Boolean类型</h2><p>是与布尔值对应的引用类型。不建议使用Boolean对象。用处不大，容易造成误解</p>
<h2 id="2-Number类型"><a href="#2-Number类型" class="headerlink" title="2. Number类型"></a>2. Number类型</h2><p>是与数字值对应的引用类型。不建议使用Number对象</p>
<p>Number类型提供了一些用于将数值格式化为字符串的方法：</p>
<p><code>toFixed()</code>  按照指定小数位返回数值的字符串表示 （会四舍五入）—适用于处理货币值</p>
<p><code>toExponential()</code>   返回质数表示法（e表示法）的字符串表示 </p>
<p><code>toPrecision ()</code>  需要得到表示某个数值的最合适的方法，可能会返回上述两个格式的一种</p>
<h2 id="3-String类型"><a href="#3-String类型" class="headerlink" title="3. String类型"></a>3. String类型</h2><p>字符串的对象包装类型。</p>
<p>每个实例都有一个length属性，表示字符串中包含的字符个数。</p>
<h3 id="3-1-字符方法"><a href="#3-1-字符方法" class="headerlink" title="3.1 字符方法"></a>3.1 字符方法</h3><p>访问字符串中特定字符：</p>
<p><code>charAt()</code>    –接受一个参数index，一单字字符串形式返回</p>
<p><code>charCodeAt()</code>     –接受一个参数index，返回字符的编码</p>
<p>也可以直接用[index]来查找</p>
<h3 id="3-2-字符串操作方法"><a href="#3-2-字符串操作方法" class="headerlink" title="3.2 字符串操作方法"></a>3.2 字符串操作方法</h3><p><code>concat()</code>   –拼接一个或多个字符串，返回新的字符串， 不改变原字符串。但在现实中，大多用+号</p>
<p><code>slice()</code>    –2个参数，开始和结束的位置。不包括最后一位；不改变原字符串</p>
<p><code>substr() </code>  – 2个参数，开始和的位置和要返回的字符串个数。不改变原字符串</p>
<p><code>substring() </code>  –2个参数，开始和结束的位置。不包括最后一位；不改变原字符串</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringValue = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">alert(stringValue.slice(<span class="number">3</span>));        <span class="comment">//&quot;lo world&quot;</span></span><br><span class="line">alert(stringValue.substring(<span class="number">3</span>));    <span class="comment">//&quot;lo world&quot;</span></span><br><span class="line">alert(stringValue.substr(<span class="number">3</span>));       <span class="comment">//&quot;lo world&quot;</span></span><br><span class="line">alert(stringValue.slice(<span class="number">3</span>, <span class="number">7</span>));     <span class="comment">//&quot;lo w&quot;</span></span><br><span class="line">alert(stringValue.substring(<span class="number">3</span>,<span class="number">7</span>));  <span class="comment">//&quot;lo w&quot;</span></span><br><span class="line">alert(stringValue.substr(<span class="number">3</span>, <span class="number">7</span>));    <span class="comment">//&quot;lo worl&quot;</span></span><br><span class="line">        </span><br><span class="line">alert(stringValue.slice(<span class="number">-3</span>));         <span class="comment">//&quot;rld&quot;   =slice(8)</span></span><br><span class="line">alert(stringValue.substring(<span class="number">-3</span>));     <span class="comment">//&quot;hello world&quot;    将-3转换成了0</span></span><br><span class="line">alert(stringValue.substr(<span class="number">-3</span>));        <span class="comment">//&quot;rld&quot;</span></span><br><span class="line">alert(stringValue.slice(<span class="number">3</span>, <span class="number">-4</span>));      <span class="comment">//&quot;lo w&quot;</span></span><br><span class="line">alert(stringValue.substring(<span class="number">3</span>, <span class="number">-4</span>));  <span class="comment">//&quot;hel&quot;</span></span><br><span class="line">alert(stringValue.substr(<span class="number">3</span>, <span class="number">-4</span>));     <span class="comment">//&quot;&quot; (empty string)</span></span><br></pre></td></tr></table></figure>



<h3 id="3-3-字符串位置方法"><a href="#3-3-字符串位置方法" class="headerlink" title="3.3 字符串位置方法"></a>3.3 字符串位置方法</h3><p><code>indexOf()</code></p>
<p><code>lastIndexOf()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringValue = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">alert(stringValue.indexOf(<span class="string">&quot;o&quot;</span>));         <span class="comment">//4</span></span><br><span class="line">alert(stringValue.lastIndexOf(<span class="string">&quot;o&quot;</span>));     <span class="comment">//7</span></span><br><span class="line">alert(stringValue.indexOf(<span class="string">&quot;o&quot;</span>, <span class="number">6</span>));         <span class="comment">//7   从w开始向后</span></span><br><span class="line">alert(stringValue.lastIndexOf(<span class="string">&quot;o&quot;</span>, <span class="number">6</span>));     <span class="comment">//4    从w开始向前</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringValue = <span class="string">&quot;Lorem ipsum dolor sit amet, consectetur adipisicing elit&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> positions = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line"><span class="keyword">var</span> pos = stringValue.indexOf(<span class="string">&quot;e&quot;</span>);</span><br><span class="line">        </span><br><span class="line"><span class="keyword">while</span>(pos &gt; <span class="number">-1</span>)&#123;</span><br><span class="line">    positions.push(pos);</span><br><span class="line">    pos = stringValue.indexOf(<span class="string">&quot;e&quot;</span>, pos + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">alert(positions);    <span class="comment">//&quot;3,24,32,35,52&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-4-trim-方法"><a href="#3-4-trim-方法" class="headerlink" title="3.4 trim()方法"></a>3.4 trim()方法</h3><p>创建副本，删除两端空格， 返回结果，不改变原字符串</p>
<h3 id="3-5-字符串大小写转换方法"><a href="#3-5-字符串大小写转换方法" class="headerlink" title="3.5 字符串大小写转换方法"></a>3.5 字符串大小写转换方法</h3><p><code>toLowerCase()</code></p>
<p><code>toUpperCase()</code></p>
<p><code>toLocalLowerCase()</code></p>
<p><code>toLocalUpperCase()</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringValue = <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">alert(stringValue.toLocaleUpperCase());  <span class="comment">//&quot;HELLO WORLD&quot;</span></span><br><span class="line">alert(stringValue.toUpperCase());        <span class="comment">//&quot;HELLO WORLD&quot;</span></span><br><span class="line">alert(stringValue.toLocaleLowerCase());  <span class="comment">//&quot;hello world&quot;</span></span><br><span class="line">alert(stringValue.toLowerCase());        <span class="comment">//&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>



<h3 id="3-6-字符串模式匹配方法"><a href="#3-6-字符串模式匹配方法" class="headerlink" title="3.6 字符串模式匹配方法"></a>3.6 字符串模式匹配方法</h3><p><code>match()</code>  –接收一个正则参数，本质上与调用RegExp上的exec()方法相同</p>
<p><code>search()</code>   –接收一个正则参数，返回第一个匹配的索引，没有则返回-1</p>
<p><code>replace()</code>  –接收2个参数，正则参数，字符串或函数， </p>
<p><code>splite()</code>  –基于指定的分隔符将一个字符串分割，并放到数组里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="string">&quot;cat, bat, sat, fat&quot;</span>; </span><br><span class="line"><span class="keyword">var</span> pattern = <span class="regexp">/.at/</span>;</span><br><span class="line">        </span><br><span class="line"><span class="keyword">var</span> matches = text.match(pattern);        </span><br><span class="line">alert(matches.index);        <span class="comment">//0</span></span><br><span class="line">alert(matches[<span class="number">0</span>]);           <span class="comment">//&quot;cat&quot;</span></span><br><span class="line">alert(pattern.lastIndex);    <span class="comment">//0</span></span><br><span class="line"><span class="keyword">var</span> pos = text.search(<span class="regexp">/at/</span>);</span><br><span class="line">alert(pos);   <span class="comment">//1</span></span><br><span class="line"><span class="keyword">var</span> result = text.replace(<span class="string">&quot;at&quot;</span>, <span class="string">&quot;ond&quot;</span>);</span><br><span class="line">alert(result);    <span class="comment">//&quot;cond, bat, sat, fat&quot;</span></span><br><span class="line">result = text.replace(<span class="regexp">/at/g</span>, <span class="string">&quot;ond&quot;</span>);</span><br><span class="line">alert(result);    <span class="comment">//&quot;cond, bond, sond, fond&quot;</span></span><br><span class="line">result = text.replace(<span class="regexp">/(.at)/g</span>, <span class="string">&quot;word ($1)&quot;</span>);</span><br><span class="line">alert(result);    <span class="comment">//word (cat), word (bat), word (sat), word (fat)</span></span><br><span class="line">        </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">htmlEscape</span>(<span class="params">text</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> text.replace(<span class="regexp">/[&lt;&gt;&quot;&amp;]/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params">match, pos, originalText</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(match)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;&lt;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&amp;lt;&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;&gt;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&amp;gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;&amp;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&amp;amp;&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;\&quot;&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;&amp;quot;&quot;</span>;</span><br><span class="line">        &#125;             </span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">alert(htmlEscape(<span class="string">&quot;&lt;p class=\&quot;greeting\&quot;&gt;Hello world!&lt;/p&gt;&quot;</span>)); <span class="comment">//&amp;lt;p class=&amp;quot;greeting&amp;quot;&amp;g</span></span><br><span class="line"><span class="keyword">var</span> colorText = <span class="string">&quot;red,blue,green,yellow&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> colors1 = colorText.split(<span class="string">&quot;,&quot;</span>);      <span class="comment">//[&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;]</span></span><br><span class="line"><span class="keyword">var</span> colors2 = colorText.split(<span class="string">&quot;,&quot;</span>, <span class="number">2</span>);   <span class="comment">//[&quot;red&quot;, &quot;blue&quot;]</span></span><br><span class="line"><span class="keyword">var</span> colors3 = colorText.split(<span class="regexp">/[^\,]+/</span>); <span class="comment">//[&quot;&quot;, &quot;,&quot;, &quot;,&quot;, &quot;,&quot;, &quot;&quot;]</span></span><br></pre></td></tr></table></figure>



<h3 id="3-7-localCompare-方法"><a href="#3-7-localCompare-方法" class="headerlink" title="3.7 localCompare()方法"></a>3.7 localCompare()方法</h3><p>比较两个字符串，返回下列的值中的一个：</p>
<ul>
<li>字母表顺序，顺序反了就返回-1，</li>
<li>等于字符串参数， 返回0</li>
<li>字母表顺序，顺序正着的就返回1</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stringValue = <span class="string">&quot;yellow&quot;</span>;       </span><br><span class="line">alert(stringValue.localeCompare(<span class="string">&quot;brick&quot;</span>));  <span class="comment">//1</span></span><br><span class="line">alert(stringValue.localeCompare(<span class="string">&quot;yellow&quot;</span>)); <span class="comment">//0</span></span><br><span class="line">alert(stringValue.localeCompare(<span class="string">&quot;zoo&quot;</span>));    <span class="comment">//-1</span></span><br><span class="line">        </span><br><span class="line"><span class="comment">//preferred technique for using localeCompare()</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">determineOrder</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> result = stringValue.localeCompare(value);</span><br><span class="line">    <span class="keyword">if</span> (result &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        alert(<span class="string">&quot;The string &#x27;yellow&#x27; comes before the string &#x27;&quot;</span> + value + <span class="string">&quot;&#x27;.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (result &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;The string &#x27;yellow&#x27; comes after the string &#x27;&quot;</span> + value + <span class="string">&quot;&#x27;.&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        alert(<span class="string">&quot;The string &#x27;yellow&#x27; is equal to the string &#x27;&quot;</span> + value + <span class="string">&quot;&#x27;.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">        </span><br><span class="line">determineOrder(<span class="string">&quot;brick&quot;</span>);</span><br><span class="line">determineOrder(<span class="string">&quot;yellow&quot;</span>);</span><br><span class="line">determineOrder(<span class="string">&quot;zoo&quot;</span>);</span><br></pre></td></tr></table></figure>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/05/01/JSPro-ReadNotes-chap4/">JS高级_ReadNotes-chap4</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-05-01T06:08:38.000Z" itemprop="datePublished">May 1, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/ReadNotes/">ReadNotes</a> <a href="/tags/JavaScript/">JavaScript</a>
</div>
    </div>
      
        <h1 id="I-基本类型-和-引用类型-的值"><a href="#I-基本类型-和-引用类型-的值" class="headerlink" title="I 基本类型 和 引用类型 的值"></a>I 基本类型 和 引用类型 的值</h1><p>变量可能包含两种数据类型的值：</p>
<ul>
<li>基本类型的值 ：简单的数据段</li>
<li>引用类型的值：可能由多个值构成的对像，保存在内存中</li>
</ul>
<blockquote>
<p>JavaScript不允许直接访问内存中的位置，即不能直接操作对象的内存空间。</p>
<p>当复制 保存着对象的某个变量时，操作的是对象的引用。</p>
<p>当为对象添加属性时，操作的才是实际的对象。</p>
</blockquote>
<h2 id="1-动态的属性"><a href="#1-动态的属性" class="headerlink" title="1. 动态的属性"></a>1. 动态的属性</h2><ul>
<li>定义 基本类型和引用类型的值的方式—-创建一个变量，并为其赋值。</li>
<li>引用类型的值–可为其添加属性和方法，也可改变和删除属性和方法—–如果对象不被销毁，则属性将一直存在</li>
<li>基本类型的值 –不能添加属性</li>
</ul>
<h2 id="2-复制变量值"><a href="#2-复制变量值" class="headerlink" title="2. 复制变量值"></a>2. 复制变量值</h2><ul>
<li><p>复制基本类型的值 –在<strong>变量对象</strong>上创建一个新值，将该值复制到位新变量分配的位置上。（新旧完全独立）</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghb610l3zgj30hu095gmg.jpg"></p>
</li>
<li><p>复制引用类型的值–复制一份放到新变量分配的空间中，但这个副本实际上是一个指针，指向存储在堆中的一个对象。（新旧引用的是同一个对象，二者互相干涉）</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghb6pej7i6j30rq0hb76j.jpg"></p>
</li>
</ul>
<h2 id="3-传递参数"><a href="#3-传递参数" class="headerlink" title="3. 传递参数"></a>3. 传递参数</h2><p>ECMAScript中所有参数都是**==按值传递==**。而访问变量有按值和按引用两种方式。</p>
<p>==把函数外部的一个值赋值给函数内部的参数== == ==把值从一个变量复制到另一个变量==</p>
<ul>
<li>向参数传递基本类型的值–将值复制给一个局部变量（命名参数/arguments对象的一个元素）</li>
<li>向参数传递引用类型的值–将值的地址复制给一个局部变量，因此<u>这个局部变量的变化会反映在函数的外部</u>。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addTen</span>(<span class="params">num</span>)</span>&#123;  <span class="comment">//num:一个局部变量</span></span><br><span class="line">  num +=<span class="number">10</span>;</span><br><span class="line">  <span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> count = <span class="number">20</span>;   <span class="comment">//count ：全局变量</span></span><br><span class="line"><span class="keyword">var</span> result = addTen(count); <span class="comment">//调用函数后，count的20传递给形参num</span></span><br><span class="line">alert(count); <span class="comment">//20</span></span><br><span class="line">alert(result); <span class="comment">//30</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//num 与 count 互不相识，互不干涉</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setName</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">  obj.name = <span class="string">&quot;Nicholas&quot;</span>;    <span class="comment">//obj和person此时引用的是同一个对象</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>(); <span class="comment">//new一个实例对象person，它是全局的</span></span><br><span class="line">setName(person);  <span class="comment">//将这个对象作参数传递给Object，调用setName函数</span></span><br><span class="line">alert(person.name);  <span class="comment">//&quot;Nicholas&quot;   函数在内部给添加的name属性，在外部也会被干涉，</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//person和obj指向的是堆内存中的同一个对象， 而且是全局的</span></span><br></pre></td></tr></table></figure>

<ul>
<li>==即使在参数内部修改了参数的值，原始的引用仍然保持不变==</li>
<li>当在函数内部重写obj时，这个变量引用的就是一个局部对象了，在函数执行完毕后被立即销毁</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setName</span>(<span class="params">obj</span>)</span>&#123;</span><br><span class="line">  obj.name = <span class="string">&quot;Nicholas&quot;</span>; </span><br><span class="line">  obj = <span class="keyword">new</span> <span class="built_in">Object</span>();  <span class="comment">//为obj重新定义了一个对象，</span></span><br><span class="line">  obj.name = <span class="string">&quot;Greg&quot;</span>;  <span class="comment">//为该对象定义了带有不同值的name属性</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="built_in">Object</span>(); </span><br><span class="line">setName(person);  </span><br><span class="line">alert(person.name);  <span class="comment">//&quot;Nicholas&quot;   说明：这里的person并不是按引用传递</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="4-检测类型"><a href="#4-检测类型" class="headerlink" title="4. 检测类型"></a>4. 检测类型</h2><ul>
<li>检查基本数据类型–<code>typeof</code></li>
<li>检查引用数据类型–<code>instanceof</code>  –返回布尔值       所有引用类型的值都是Object实例</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&quot;Nicholas&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">var</span> i = <span class="number">22</span>;</span><br><span class="line"><span class="keyword">var</span> u;</span><br><span class="line"><span class="keyword">var</span> n = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> o = <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">        </span><br><span class="line">alert(<span class="keyword">typeof</span> s);   <span class="comment">//string</span></span><br><span class="line">alert(<span class="keyword">typeof</span> i);   <span class="comment">//number</span></span><br><span class="line">alert(<span class="keyword">typeof</span> b);   <span class="comment">//Boolean</span></span><br><span class="line">alert(<span class="keyword">typeof</span> u);   <span class="comment">//undefined</span></span><br><span class="line">alert(<span class="keyword">typeof</span> n);   <span class="comment">//object</span></span><br><span class="line">alert(<span class="keyword">typeof</span> o);   <span class="comment">//object</span></span><br><span class="line"></span><br><span class="line">result = variable <span class="keyword">instanceof</span> <span class="keyword">constructor</span></span><br><span class="line">alert(person instance of Object);  //变量person是Object吗？</span><br><span class="line">alert(colors instance of Array);  //变量colors是Array吗？</span><br><span class="line">alert(pattern instance of RegExp);  //变量pattern是RegExp吗？</span><br></pre></td></tr></table></figure>



<h1 id="II-执行环境及作用域"><a href="#II-执行环境及作用域" class="headerlink" title="II 执行环境及作用域"></a>II 执行环境及作用域</h1><blockquote>
<p><code>执行环境execution context</code>  定义了 变量或函数有权访问的其他数据，决定了他们各自的行为。</p>
<p><code>变量对象variable object</code>  每个执行环境都有一个与之关联的变量对象，他保存着环境中定义的所有变量和函数。</p>
<p>全局执行环境—-window对象</p>
<p>所有全局变量和函数 都是 作为 window对象是属性 和 方法创建的。</p>
<p>执行环境中的代码全部执行完毕后，该环境会被销毁。</p>
<p>每个函数都有自己的执行环境。</p>
<p><code>执行流</code></p>
<p><code>环境栈</code></p>
<p>执行流进入函数 → 函数被推倒环境栈中 → 函数执行完毕 → 被推出环境栈 → 被交给之前的执行环境</p>
</blockquote>
<blockquote>
<p><code>作用域链</code> 代码在环境中执行时创建，<u>保证</u> 对执行环境有权访问的变量和函数的 <u>有序访问</u></p>
<p>作用域链 从前往后的顺序： 当前执行环境（函数，活动对象，开始只包含arguments对象） → 外部执行环境 → 下一个外部执行环境 ···· → 全局执行环境</p>
<p>里面的能访问外面的，外面的不能访问里面的。—这些环境之间的联系是线性的，有序的</p>
</blockquote>
<h2 id="1-延长作用域链"><a href="#1-延长作用域链" class="headerlink" title="1. 延长作用域链"></a>1. 延长作用域链</h2><p>一些语句可以在作用域前端临时增加一个变量对象，它会在代码执行后被移除。</p>
<ul>
<li>try-catch语句 的 catch块 ：会创建一个新的变量对象，包含被抛出的错误对象的声明。23</li>
<li>with语句 ：会将指定的变量添加到作用域链中</li>
</ul>
<h2 id="2-没有块级作用域"><a href="#2-没有块级作用域" class="headerlink" title="2. 没有块级作用域"></a>2. 没有块级作用域</h2><blockquote>
<p>if语句中的变量声明会将变量添加到当前的执行环境（可能是全局环境）</p>
<p>for语句创建的变量i 在for循环执行结束后，依旧会存在循环外部的执行环境之中</p>
</blockquote>
<h3 id="2-1-声明变量"><a href="#2-1-声明变量" class="headerlink" title="2.1 声明变量"></a>2.1 声明变量</h3><blockquote>
<p>使用var声明的变量会自动被添加到最接近的环境中，</p>
<p>在函数内部–就是函数的局部环境；</p>
<p>在with语句中–就是函数环境</p>
</blockquote>
<ul>
<li>若初始化变量时没有使用var声明，则该变量会自动被添加到全局环境</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> sum = num1 +num2;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = add(<span class="number">10</span>, <span class="number">20</span>); <span class="comment">//30</span></span><br><span class="line">alert(sum); <span class="comment">//Error</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">num1, num2</span>)</span>&#123;</span><br><span class="line">    sum = num1 +num2;</span><br><span class="line">  <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> result = add(<span class="number">10</span>, <span class="number">20</span>); <span class="comment">//30</span></span><br><span class="line">alert(sum); <span class="comment">//30</span></span><br></pre></td></tr></table></figure>



<h3 id="2-2-查询标识符"><a href="#2-2-查询标识符" class="headerlink" title="2.2 查询标识符"></a>2.2 查询标识符</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> color =<span class="string">&quot;blue&quot;</span>;   <span class="comment">//在外面找到了color是blue</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getColor</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> color;  <span class="comment">//在里面没找到color，就到到外面去找</span></span><br><span class="line">&#125;</span><br><span class="line">alert(getColor);   <span class="comment">//blue</span></span><br></pre></td></tr></table></figure>

<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghbbmodu0tj30bd0b8mxi.jpg"></p>
<h1 id="III-垃圾收集"><a href="#III-垃圾收集" class="headerlink" title="III 垃圾收集"></a>III 垃圾收集</h1><blockquote>
<p>JavaScript有垃圾自动收集机制：执行环境会负责<strong>管理</strong><u>代码执行过程中使用</u>的<strong>内存</strong>。</p>
<p>垃圾自动收集机制の原理：找出不再继续使用的变量，释放他们占用的内存。（以固定的时间间隔，周期性执行）</p>
<p>函数中局部变量的生命周期—–函数执行的过程</p>
<p>垃圾收集器会标识无用变量。</p>
<p>可以使用任何方式标记变量。（翻转特殊的位；使用变量列表跟踪）</p>
</blockquote>
<h2 id="1-标记清除"><a href="#1-标记清除" class="headerlink" title="1. 标记清除"></a>1. 标记清除</h2><p>最常用的垃圾收集方式—-标记清除mark-and-sweep</p>
<p>标记为：“进入环境”（不能清除）→ “离开环境”</p>
<h2 id="2-引用计数"><a href="#2-引用计数" class="headerlink" title="2. 引用计数"></a>2. 引用计数</h2><p>跟踪记录每个值被引用的次数。—–循环引用问题</p>
<h2 id="3-性能问题"><a href="#3-性能问题" class="headerlink" title="3. 性能问题"></a>3. 性能问题</h2><h2 id="4-管理内存"><a href="#4-管理内存" class="headerlink" title="4. 管理内存"></a>4. 管理内存</h2><p>内存限制问题</p>
<p>解除引用dereferencing</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/04/18/依然webpack/">依然webpack</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-04-18T05:09:42.000Z" itemprop="datePublished">Apr 18, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/webpack/">webpack</a>
</div>
    </div>
      
        <p>Jin天想扣一扣webpack的loader和plugin，以及babel编译的一些学习心得~<br>好长时间没更新啦<del>坚持学习 喵</del></p>
<hr>
<h1 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h1><p>webpack只能处理js文件，其他的文件形式，需要loader</p>
<p>👇</p>
<p>loader：翻译、管道，会把一个东西转成另一种东西</p>
<h1 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h1><p>插件，不是负责给webpack提供东西的，只处理额外的工作，独立与webpack之外，它的成功也不用跟webpack反馈，如校验之类的工作，与webpack程序平行工作</p>
<p>plugin：辅助webpack工作的，它的结果不给webpack</p>
<hr>
<h1 id="loader怎么用"><a href="#loader怎么用" class="headerlink" title="loader怎么用"></a>loader怎么用</h1><blockquote>
<p>css编译：</p>
<p>npm i css-loader style-loader -D    (既能读进来处理好，也能显示到页面)</p>
<p>css-loader：css打包，以及处理css当中的一些引入，如@import</p>
<p>style-loader：css打包后还需要渲染到页面</p>
</blockquote>
<h2 id="loader配置："><a href="#loader配置：" class="headerlink" title="loader配置："></a>loader配置：</h2><h3 id="1-单loader"><a href="#1-单loader" class="headerlink" title="1.单loader"></a>1.单loader</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;test: / /, use: &#x27;xxx-loader&#x27;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-多个loader"><a href="#2-多个loader" class="headerlink" title="2.多个loader"></a>2.多个loader</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;test: / /, use: [&#x27;xxx-loader&#x27;, &#x27;xxx-loader&#x27;]&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-loader-参数"><a href="#3-loader-参数" class="headerlink" title="3.loader+参数"></a>3.loader+参数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123; test: / /, use: &#123;</span><br><span class="line">  loader: &#x27;xx-loader&#x27;,</span><br><span class="line">  options: &#123;</span><br><span class="line">    a: &#x27;&#x27;, </span><br><span class="line">    b: &#x27;&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-多loader-参数"><a href="#4-多loader-参数" class="headerlink" title="4.多loader+参数"></a>4.多loader+参数</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;test: / /, use: [</span><br><span class="line">  &#123;</span><br><span class="line">    loader: &#x27;xxx-loader&#x27;,</span><br><span class="line">    options: ...</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    loader: &#x27;xxx2-loader&#x27;,</span><br><span class="line">    options: xxx</span><br><span class="line">  &#125;</span><br><span class="line">]&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;test: / /, use: [</span><br><span class="line">  &#x27;xxx-loader&#x27;, &#123;</span><br><span class="line">    loader: &#x27;xxx2-loader&#x27;,</span><br><span class="line">    options: xxx</span><br><span class="line">  &#125;</span><br><span class="line">]&#125;</span><br></pre></td></tr></table></figure>



<hr>
<blockquote>
<p>图片编译</p>
<p>file-loader   读取文件、不做处理、直接输出，保证通用性<br>url-loader    读取文件、把文件的内容转换成base64，打包到bundle里面</p>
<p>👆两个东西要一起装</p>
<p>base64：<br>1.优点——减少请求<br>2.缺点——略微增加文件体积<br>1.3K -&gt; 1.5K<br>10%~20%</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">test: /\.(jpg|png|gif|webp|ico)$/i,</span><br><span class="line">use: &#123;</span><br><span class="line"> loader: &quot;file-loader&quot;,</span><br><span class="line"> options: &#123;</span><br><span class="line">   outputPath: &quot;imgs/&quot;,</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">test: /\.(jpg|png|gif|webp|ico)$/i,</span><br><span class="line">use: &#123;</span><br><span class="line"> loader: &quot;url-loader&quot;,</span><br><span class="line"> options: &#123;</span><br><span class="line">   <span class="comment">// 大于limit的文件会直接pass，以原样输出</span></span><br><span class="line">   <span class="comment">// 加入限制是8k</span></span><br><span class="line">   limit: 8 * 1024,</span><br><span class="line">   outputPath: &quot;imgs/&quot;,</span><br><span class="line"> &#125;,</span><br><span class="line">&#125;,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>引发问题：路径会出问题~</p>
<p>file-loader和url-loader处理同一张图片（通过改变limit限制），会出来不同的路径</p>
<p>👇</p>
<p>publicPath：将来文件发布了之后，文件路径会以什么为基准，就是一个字符串链接，类似baseURL</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gisvz0kq8rj30fp03tgls.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gisvz83wivj30k503vjrl.jpg"></p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gisw06b3psj30c1049mx8.jpg" style="zoom:150%;" />



<p>publicPath在开发时和发布时也不同哦~</p>
</blockquote>
<hr>
<p>压缩图片  image-loader</p>
<blockquote>
<p>less编译</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//less</span></span><br><span class="line">&#123; <span class="attr">test</span>: <span class="regexp">/\.less$/</span>, </span><br><span class="line">use: [<span class="string">&#x27;style-loader&#x27;</span>, <span class="string">&#x27;css-loader&#x27;</span>, <span class="string">&#x27;less-loader&#x27;</span>] </span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
</blockquote>
<hr>
<h1 id="Vue-loader"><a href="#Vue-loader" class="headerlink" title="Vue-loader"></a>Vue-loader</h1><p>npm i <u>vue-loader</u> <u>webpack webpack-cli</u> <u>vue-style-loader</u> <u>vue-html-loader</u> <u>vue-template-compile</u>  -D</p>
<ul>
<li><p>vue-loader：编译vue</p>
</li>
<li><p>webpack webpack-cli：编译vue必备</p>
</li>
<li><p>vue-style-loader：编译vue里的样式，style-loader的一个子集</p>
</li>
<li><p>vue-html-loader：编译vue文件里的template里的html的一些引用，如scr引入图片之类的</p>
</li>
<li><p>vue-template-compile：编译vue模板的，里面有些花括号之类的</p>
<p>作用：①在编译模板的时候发现模板的问题 ②预编译方式提高性能</p>
</li>
</ul>
<p><strong>预编译</strong>：打包时就已经编译完了—-提前发现问题，提升性能~</p>
<p><strong>运行时编译</strong>：到了浏览器之后再编译</p>
<hr>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> VueLoaderPlugin = <span class="built_in">require</span>(<span class="string">&quot;vue-loader/lib/plugin&quot;</span>);   <span class="comment">//②从vue-loader引入这个插件</span></span><br><span class="line">-------</span><br><span class="line">  </span><br><span class="line"> <span class="built_in">module</span>: &#123;</span><br><span class="line">     <span class="comment">// VUE编译</span></span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.vue$/</span>, use: <span class="string">&quot;vue-loader&quot;</span> &#125;,                <span class="comment">//①安装vue-loader后引入这个loader</span></span><br><span class="line"> &#125;</span><br><span class="line">-------</span><br><span class="line">  <span class="comment">//VueLoaderPlugin是用来做模板编译的，做了vue-loader的一部分工作</span></span><br><span class="line">plugins: [<span class="keyword">new</span> VueLoaderPlugin()]                             <span class="comment">//③new一下才能用</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue&quot;</span>;--&gt;??这里直接引vue不行，因为vue只是浏览器运行时的库，没有ECMAScript模块ES6的库</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./cmp1.vue&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#root&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>引vue，会报错👇</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1giup2z0htjj30n4020glv.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1gisx1noc8tj30a20bymxl.jpg"></p>
<p>这里的vue.esm.js是ECMAScript的module，ES模块的VUE，</p>
<p>现在import一个VUE，要保证那边有exportVUE，所以我们这里不能引import Vue from “vue”;</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&quot;vue/dist/vue.esm&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./cmp1.vue&quot;</span>;  ---&gt;这种引入实际上等同于 cmp1 = vue.extend 这种局部写法，所以要用components</span><br><span class="line">                        <span class="comment">//👇</span></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&quot;#root&quot;</span>,          <span class="comment">//👇</span></span><br><span class="line">  components: &#123;    <span class="comment">// 👈</span></span><br><span class="line">    cmp1,</span><br><span class="line">  &#125;,</span><br><span class="line">  template:<span class="string">`&lt;cmp1&gt;&lt;/cmp1&gt;`</span>      <span class="comment">//着这里要添加template把cmp1输出去，为了不让VUE与thml混在一起</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<p>此时，远远不够，如果出现async异步操作，就无法往下进行，</p>
<p>so</p>
<p>👇</p>
<hr>
<h1 id="babel编译"><a href="#babel编译" class="headerlink" title="babel编译"></a>babel编译</h1><p>把特别高版本的语言编译给较低版本的浏览器~</p>
<p>npm i babel-loader @babel/core @babel/preset-env -D</p>
<p> @babel/preset-env是一个预设，能根据需求选择配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//js</span></span><br><span class="line">&#123;<span class="attr">test</span>: <span class="regexp">/\.jsx?$/i</span>, use: &#123;</span><br><span class="line">  loader: <span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">  options: &#123;</span><br><span class="line">    presets: [<span class="string">&#x27;@babel/preset-env&#x27;</span>]</span><br><span class="line">    <span class="comment">// presets: [</span></span><br><span class="line">    <span class="comment">//   [&#x27;@babel/preset-env&#x27;, &#123;</span></span><br><span class="line">    <span class="comment">//     targets: &#123;</span></span><br><span class="line">    <span class="comment">//       chrome: 58,</span></span><br><span class="line">    <span class="comment">//       ie: 7</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//   &#125;]</span></span><br><span class="line">    <span class="comment">// ]</span></span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>👇</p>
<p>加了babel之后，遇到async会报错</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1giupk3hvf4j30hn06675c.jpg"></p>
<p>因为babel是向下兼容的，async是ES7语言，babel会用regeneraterRuntime把他编译成低版本的回调函数 —&gt;polyfill登场</p>
<p>babel -&gt; async -&gt; regenerator （这时候要求有polyfill在才能实现上述过程）</p>
<p><code>polyfill</code>——是一个库，补充js的功能</p>
<p>npm i @babel/polyfill -S   </p>
<p>他是一个js文件，写在entry里</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">···</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">  mode: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">  entry: [<span class="string">&#x27;@babel/polyfill&#x27;</span>, <span class="string">&#x27;./src/index&#x27;</span>]</span><br><span class="line">  </span><br><span class="line">  ···</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>思路：</p>
<p>1.babel——降级（兼容低版本）</p>
<p>👇</p>
<p>2.async函数</p>
<p>👇</p>
<p>3.polyfill</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/03/03/后端接口构建-02/">后端接口构建-02</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-03-03T08:48:34.000Z" itemprop="datePublished">Mar 3, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/nodejs/">nodejs</a> <a href="/tags/myProject/">myProject</a>
</div>
    </div>
      
        <p>啦啦啦~<br>今天内容比较简单，配置信息的增删改查接口，没有啥好说的，就是细心，直接上代码啦~👇</p>
<p>配置信息接口</p>
<ul>
<li><p>创建model–Profile.js</p>
</li>
<li><p>按照User.js格式进行修改</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Schema</span></span><br><span class="line"><span class="keyword">const</span> ProfileSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  type: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  b_name: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  author: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  isbn_num: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  status: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  remark: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  date: &#123;</span><br><span class="line">    type: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="built_in">Date</span>.now,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Profile = mongoose.model(<span class="string">&quot;profile&quot;</span>, ProfileSchema);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在routers里创建profiles.js接口文件</p>
</li>
<li><p>到入口文件server.js中引入profiles.js，并使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入profiles.js</span></span><br><span class="line"><span class="keyword">const</span> profiles = <span class="built_in">require</span>(<span class="string">&quot;./routers/api/profiles&quot;</span>);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&quot;/api/profiles&quot;</span>, profiles);</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置profiles.js文件，同样引入express，router，passport，以及Profile模型（Profile.js），先写个测试get请求，测试一下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="keyword">const</span> passport = <span class="built_in">require</span>(<span class="string">&quot;passport&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Profile = <span class="built_in">require</span>(<span class="string">&quot;../../models/Profile&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// $route GET api/profiles/test</span></span><br><span class="line"><span class="comment">// @desc  返回请求的json数据</span></span><br><span class="line"><span class="comment">// @access public</span></span><br><span class="line">router.get(<span class="string">&quot;/test&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123; <span class="attr">msg</span>: <span class="string">&quot;profile works&quot;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>↓</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghxaamvf3vj30ek0c7jrp.jpg"></p>
</li>
</ul>
<p>接口OK了，接下来要获取到一些信息，添加、编辑、删除</p>
<p>↓</p>
<ul>
<li>添加信息接口 POST请求</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route POST api/profiles/add</span></span><br><span class="line"><span class="comment">// @desc  创建信息接口</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/add&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.body.type) profileFields.type = req.body.type;</span><br><span class="line">    <span class="keyword">if</span> (req.body.b_name) profileFields.b_name = req.body.b_name;</span><br><span class="line">    <span class="keyword">if</span> (req.body.author) profileFields.author = req.body.author;</span><br><span class="line">    <span class="keyword">if</span> (req.body.isbn_num) profileFields.isbn_num = req.body.isbn_num;</span><br><span class="line">    <span class="keyword">if</span> (req.body.status) profileFields.status = req.body.status;</span><br><span class="line">    <span class="keyword">if</span> (req.body.remark) profileFields.remark = req.body.remark;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">new</span> Profile(profileFields).save().then(<span class="function">(<span class="params">profile</span>) =&gt;</span> &#123;</span><br><span class="line">      res.json(profile);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>测试一下~<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghxc514z5ij30k70ey75i.jpg"></li>
</ul>
<p>↓</p>
<p>获取信息</p>
<ul>
<li><p>获取全部信息，这里直接采用GET就行</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route GET api/profiles/</span></span><br><span class="line"><span class="comment">// @desc  获取所有信息接口</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.find()</span><br><span class="line">      .then(<span class="function">(<span class="params">profile</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.status(<span class="number">404</span>).json(<span class="string">&quot;没找到这条内容呀@_@&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.json(profile);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).json(err));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>测试一下~<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghxcmar20zj30i60hmwfw.jpg"></p>
</li>
<li><p>获取单个信息</p>
<p>还是采用GET方式，只是这里采用findOne()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route GET api/profiles/:id</span></span><br><span class="line"><span class="comment">// @desc  获取单个信息接口</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">&quot;/:id&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.findOne(&#123; <span class="attr">_id</span>: req.params.id &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">profile</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!profile) &#123;</span><br><span class="line">          <span class="keyword">return</span> res.status(<span class="number">404</span>).json(<span class="string">&quot;没找到这条内容呀@_@&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res.json(profile);</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).json(err));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>测试一下~</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghxcsrrxadj30hf0g0q4a.jpg"></p>
</li>
</ul>
<p>↓</p>
<p>编辑内容（类似添加内容）</p>
<p>这里使用findOneAndUpdate方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route POST api/profiles/edit</span></span><br><span class="line"><span class="comment">// @desc  编辑信息接口</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.post(</span><br><span class="line">  <span class="string">&quot;/edit/:id&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> profileFields = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (req.body.type) profileFields.type = req.body.type;</span><br><span class="line">    <span class="keyword">if</span> (req.body.b_name) profileFields.b_name = req.body.b_name;</span><br><span class="line">    <span class="keyword">if</span> (req.body.author) profileFields.author = req.body.author;</span><br><span class="line">    <span class="keyword">if</span> (req.body.isbn_num) profileFields.isbn_num = req.body.isbn_num;</span><br><span class="line">    <span class="keyword">if</span> (req.body.status) profileFields.status = req.body.status;</span><br><span class="line">    <span class="keyword">if</span> (req.body.remark) profileFields.remark = req.body.remark;</span><br><span class="line"></span><br><span class="line">    Profile.findOneAndUpdate(</span><br><span class="line">      &#123; <span class="attr">_id</span>: req.params.id &#125;,</span><br><span class="line">      &#123; <span class="attr">$set</span>: profileFields &#125;,</span><br><span class="line">      &#123; <span class="attr">new</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    ).then(<span class="function">(<span class="params">profile</span>) =&gt;</span> res.json(profile));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<ul>
<li>测试（修改前端–&gt;前端IT）<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghxd1awbzxj30gb0e875g.jpg"></li>
</ul>
<p>↓</p>
<p>删除内容</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route POST api/profiles/delete/:id</span></span><br><span class="line"><span class="comment">// @desc  删除信息接口</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.delete(</span><br><span class="line">  <span class="string">&quot;/delete/:id&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    Profile.findOneAndRemove(&#123; <span class="attr">_id</span>: req.params.id &#125;)</span><br><span class="line">      .then(<span class="function">(<span class="params">profile</span>) =&gt;</span> &#123;</span><br><span class="line">        profile.save().then(<span class="function">(<span class="params">profile</span>) =&gt;</span> res.json(profile));</span><br><span class="line">      &#125;)</span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> res.status(<span class="number">404</span>).res.json(<span class="string">&quot;删除失败啦~ &gt;_&lt;&quot;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>




      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/03/01/后台接口构建-01/">后台接口构建-01</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-02-28T16:24:37.000Z" itemprop="datePublished">Mar 1, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/nodejs/">nodejs</a> <a href="/tags/myProject/">myProject</a>
</div>
    </div>
      
        <p>写在前面的话<del>~</del></p>
<p>每年的读书计划都不了了之….买了新书忘了旧书说的就是我🤦‍♀️🤦‍♀️<br>so…想建一个私人图书馆小平台，记录购买的书和每本书的阅读进度</p>
<p>今天先写点学习の后台接口搭建步骤和bug解决（bug一卡卡三年我是什么样的心情…)<br>👨‍💻‍</p>
<p>构建接口文档：Node+express+jwt(实现token)</p>
<blockquote>
<p>接口文档内容：Nodejs</p>
<ul>
<li>准备工作： <ul>
<li>搭建服务器</li>
<li>链接MongoDB</li>
<li>搭建路由和数据模型</li>
</ul>
</li>
<li>注册登录接口<ul>
<li>注册接口数据存储</li>
<li>全球公认头像</li>
<li>登录接口数据存储</li>
<li>JWT实现token</li>
</ul>
</li>
</ul>
</blockquote>
<hr>
<p>Node-app文件夹下：npm init  初始化项目</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpf0kcfj30ea05uaa8.jpg"></p>
<p>↓</p>
<p>在VScode里打开项目，快捷键ctr+`在vscode里打开终端，在当前node-app文件夹创建入口文件touch server.js</p>
<p>↓</p>
<p>安装express包  npm install express</p>
<p>↓</p>
<p>在入口文件开始搭建服务器:  </p>
<ul>
<li><p>引入express框架   const express = <strong>require</strong>(‘express’);</p>
</li>
<li><p>实例化一个app,    const app = <strong>express</strong>();</p>
</li>
<li><p>给予一个端口号  const port = process.env.PORT <strong>||</strong> 5000;   (本地端口号是5000)</p>
</li>
<li><p>监听一下app, 并打印处相应端口号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.listen(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Server is running on port <span class="subst">$&#123;port&#125;</span>`</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>↓</p>
<p>在终端 node server.js 就可以运行该项目了，但此时还没有设置任何路由，暂时还无法访问哦~~</p>
<p>↓</p>
<p>在实例化的app下设置个路由：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&quot;/&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>↓</p>
<p>用nodemon server.js 启动服务器~~</p>
<p>↓</p>
<p>在package.json里的scripts里更改自定义命令</p>
<ul>
<li>npm run start  : 项目最后上线时</li>
<li>npm run server：项目还在开发时，实时监测改变</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">  &quot;start&quot;: &quot;node server.js&quot;,</span><br><span class="line">  &quot;server&quot;: &quot;nodemon server.js&quot;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>↓</p>
<p>链接MongoDB数据库:</p>
<ul>
<li>登录mongodb线上数据库，新建数据库</li>
<li>用mongoDB Compass 方式链接 mongodb+srv://amork:<a href="mailto:&#x6a;&#x69;&#x6e;&#x67;&#57;&#x38;&#53;&#x34;&#54;&#x34;&#64;&#x63;&#108;&#x75;&#x73;&#x74;&#x65;&#114;&#x30;&#x2e;&#106;&#105;&#111;&#x67;&#121;&#x2e;&#x6d;&#x6f;&#x6e;&#x67;&#x6f;&#x64;&#98;&#x2e;&#x6e;&#x65;&#x74;">&#x6a;&#x69;&#x6e;&#x67;&#57;&#x38;&#53;&#x34;&#54;&#x34;&#64;&#x63;&#108;&#x75;&#x73;&#x74;&#x65;&#114;&#x30;&#x2e;&#106;&#105;&#111;&#x67;&#121;&#x2e;&#x6d;&#x6f;&#x6e;&#x67;&#x6f;&#x64;&#98;&#x2e;&#x6e;&#x65;&#x74;</a>/test</li>
</ul>
<p>↓</p>
<p>在项目中安装mongoose包  npm install mongoose</p>
<p>在server.js入口文件中引入const mongoose = <strong>require</strong>(“mongoose”);</p>
<p>这样我们就可以直接使用mongoose对象连接数据库</p>
<p>↓</p>
<p>我们新建一个专用文件夹config，新建文件keys.js,</p>
<p>在该文件夹下，exports模块，写入mongoURI：拷贝的地址</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  mongoURI: <span class="string">&quot;mongodb+srv://amork:jing985464@cluster0.jiogy.mongodb.net/test&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在入口文件引入模块：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&quot;./config/keys&quot;</span>).mongoURI;</span><br></pre></td></tr></table></figure>

<p>这样做的好处： 可以手动更改数据库连接的地址mongoURI，如果想用本地数据库</p>
<p>连接数据库—mongoose.connect</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//connect to mongodb</span></span><br><span class="line">mongoose</span><br><span class="line">  .connect(db)</span><br><span class="line">  .then(<span class="function">() =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&quot;mongoDB connected&quot;</span>))</span><br><span class="line">  .catch(<span class="function">(<span class="params">error</span>) =&gt;</span> <span class="built_in">console</span>.log(error));</span><br></pre></td></tr></table></figure>

<p>此时terminal中若返回mongoDB connected，则表示连接成功</p>
<p>↓</p>
<p>小问题：终端中还会出现如下警告：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpgf84zj30q404tt9i.jpg"></p>
<p>解决： 拷贝{ useNewUrlParser: <strong>true</strong>, useUnifiedTopology: <strong>true</strong> } 粘贴到 connect(db, 这里)</p>
<p>此时发现没有报错啦~~</p>
<p>↓</p>
<p>下面就开始搭建自己的接口啦~</p>
<p>创建文件夹routers –&gt;APIs –&gt; 新建文件users.js 用来用户登录和注册</p>
<ul>
<li><p>同理引入express，再实例化一个router，并创建路由链接，最后别忘了暴露出去哦~</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&quot;/test&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.json(&#123;<span class="attr">msg</span>:<span class="string">&quot;login works&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//这里response一个json对象，包含msg,表示当访问localhost:5000/test时，会返回msg里的话</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在入口文件引入user路由，并使用它</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入user.js</span></span><br><span class="line"><span class="keyword">const</span> users = <span class="built_in">require</span>(<span class="string">&quot;./routers/api/users&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用routers</span></span><br><span class="line">app.use(<span class="string">&quot;/api/users&quot;</span>, users);</span><br></pre></td></tr></table></figure>
</li>
<li><p>在浏览器中输入localhost：5000/api/users/test 检查路由是否设置成功</p>
<p>当然也可用第三方工具postman测试接口<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpfhodmj30ca02sjr9.jpg"></p>
</li>
</ul>
<p>↓</p>
<p>创建模型存储对应的数据：</p>
<ul>
<li><p>创建文件夹models –&gt; 创建User.js文件，引入mongoose（要将数据存储在其中），再实例化一个Schema，创建集合，向集合中插入数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Schema</span></span><br><span class="line"><span class="keyword">const</span> UserSchema = <span class="keyword">new</span> Schema(&#123;&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建集合规则：登录和注册时，需要什么，就在Schema对象中写什么(暂时先马马虎虎写一下，最后再修改)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create Schema</span></span><br><span class="line"><span class="keyword">const</span> UserSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  password: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">    required: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  avatar: &#123;</span><br><span class="line">    type: <span class="built_in">String</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  date: &#123;</span><br><span class="line">    type: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="keyword">default</span>: <span class="built_in">Date</span>.now</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>最后使用使用规则创建集合，并暴露出去</p>
<p>model里的参数：（集合名称，集合规则）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = User = mongoose.model(<span class="string">&quot;users&quot;</span>, UserSchema);</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>↓</p>
<p>搭建用户登录页面的register接口：</p>
<ul>
<li><p>因为注册的时候一定会传递一些对应信息，所以要改用post请求</p>
</li>
<li><p>安装第三方模块 bodyParser – npm install body-parser</p>
</li>
<li><p>在入口文件中引入body-parser：const bodyParser = <strong>require</strong>(“body-parser”);</p>
</li>
<li><p>// <em>使用body-parser中间件</em></p>
<p>app.<strong>use</strong>(bodyParser.<strong>urlencoded</strong>({ extended: <strong>false</strong> }));</p>
<p>app.<strong>use</strong>(bodyParser.<strong>json</strong>());</p>
</li>
<li><p>在路由user.js中引入User模块，添加post请求</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route GET api/users/register</span></span><br><span class="line"><span class="comment">// @desc  返回请求的json数据</span></span><br><span class="line"><span class="comment">// @access public</span></span><br><span class="line">router.post(<span class="string">&quot;/register&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// console.log(req.body);</span></span><br><span class="line">  <span class="comment">//查询数据库中是否拥有邮箱</span></span><br><span class="line">  User.findOne(&#123; <span class="attr">email</span>: req.body.email &#125;).then(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (user) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">email</span>: <span class="string">&quot;邮箱已被注册&quot;</span> &#125;);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> newUser = <span class="keyword">new</span> User(&#123;</span><br><span class="line">        name: req.body.name,</span><br><span class="line">        email: req.body.email,</span><br><span class="line">        avatar: avatar,</span><br><span class="line">        password: req.body.password,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果要给密码，需要安装bcrypt—-npm install bcrypt，并在当前文件引入</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpdbj59j30v90acdhk.jpg"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 给密码加密</span></span><br><span class="line">bcrypt.genSalt(<span class="number">10</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, salt</span>) </span>&#123;</span><br><span class="line">  bcrypt.hash(newUser.password, salt, <span class="function">(<span class="params">err, hash</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err; <span class="comment">// 如果出错了 直接抛出错误</span></span><br><span class="line">    newUser.password = hash;  <span class="comment">// 密码变成hash值</span></span><br><span class="line">    newUser</span><br><span class="line">      .save()   <span class="comment">//调用save存储数据</span></span><br><span class="line">      .then(<span class="function"><span class="params">user</span> =&gt;</span> res.json(user))       <span class="comment">//并且但会json对象</span></span><br><span class="line">      .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err));   <span class="comment">//如果错误则打印错误</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试下是否能讲当前数据存到数据库中<br>出现报错 ：</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpem9jwj30no03smxs.jpg"></p>
<p>解决：可能是无法识别ES6语法，把箭头函数改为普通函数, thow err 改为 return err</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.hash(newUser.password, <span class="number">10</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, hash</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="keyword">return</span> err;</span><br><span class="line">  &#125;</span><br><span class="line">  newUser.password = hash;</span><br><span class="line">  newUser</span><br><span class="line">    .save()</span><br><span class="line">    .then(<span class="function">(<span class="params">user</span>) =&gt;</span> res.json(user))</span><br><span class="line">    .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行后可在postman中拿到加密过后的数据<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpe2o0wj30iy04n0t4.jpg"></p>
<p>完整的请求👇</p>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwf820ayxj30ds069wex.jpg" style="zoom:150%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwf8e38r3j30bi065jrq.jpg" style="zoom:150%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwf920x46j30vy02dq32.jpg" style="zoom:200%;" />
</li>
<li><p>来到MongoDB Compass的控制面板里，查看数据库中新增了test目录，里面保存了users，数据已经传上来啦~</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfpfyvznj30rk0dmabj.jpg"></p>
</li>
</ul>
<p>↓</p>
<p>关于头像的问题avartar—使用第三方gravatar</p>
<ul>
<li><p>npm install gravatar</p>
</li>
<li><p>在需要使用的地方（users.js)中引入，const gravatar = <strong>require</strong>(“gravatar”);</p>
</li>
<li><p>在newUser之前，定义avatar先<br>(官网copy)：</p>
<ul>
<li>url代表gravatar下的一个方法，接受2个参数，第一个是用户邮箱，第二个是一些options，<ul>
<li>s: size</li>
<li>r:rating   （可能是一种图片的参数）</li>
<li>d:default</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> url = gravatar.url(<span class="string">&#x27;emerleite@gmail.com&#x27;</span>, &#123;<span class="attr">s</span>: <span class="string">&#x27;200&#x27;</span>, <span class="attr">r</span>: <span class="string">&#x27;pg&#x27;</span>, <span class="attr">d</span>: <span class="string">&#x27;404&#x27;</span>&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>对代码稍作改动</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> avatar = gravatar.url(<span class="string">&quot;req.body.email&quot;</span>, &#123;</span><br><span class="line">        s: <span class="string">&quot;200&quot;</span>,</span><br><span class="line">        r: <span class="string">&quot;pg&quot;</span>,</span><br><span class="line">        d: <span class="string">&quot;mm&quot;</span>,</span><br><span class="line">      &#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>在postman中用一个新邮箱测试一下，此时已经拿到了avatar的地址<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwfzpzvmkj30jj050dgg.jpg"></p>
<p>这个地址显示的图像是介个样子👉<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwg23njtcj305p05smwy.jpg" style="zoom:80%;" /></p>
<p>如果用真实的，设置过avatar头像的邮箱来做avatar请求，则会拿到你真实的头像哦~</p>
</li>
</ul>
<p>↓</p>
<p>搭建登录接口：</p>
<ul>
<li><p>继续在users.js里添加登录接口，此时要求返回token， jwt passport</p>
</li>
<li><p>拿到email和password之后与数据库进行匹配， 密码匹配这里用到了bcrypt里面的compare<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwgktc25vj30o203n74q.jpg"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.compare(password, user.password).then(<span class="function">(<span class="params">isMatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">    res.json(&#123; <span class="attr">msg</span>: <span class="string">&quot;success&quot;</span> &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">password</span>: <span class="string">&quot;密码错误&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>先不做token，在res.json里直接返回msg, 看下能否在邮箱正确，错误，密码正确，错误的情况下能否正确返回：</p>
<p>正确情况下👇：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwgqxb9xzj30fu0b4dg9.jpg"><br>邮箱错误👇：<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwgsmr166j30e509wt91.jpg"></p>
<p>密码错误👇：</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwgt8vdvsj30du0a6glx.jpg"></p>
</li>
<li><p>返回token：</p>
<ul>
<li><p>npm install jsonwebtoken</p>
</li>
<li><p>引入jsonwebtoken，起名jwt</p>
</li>
<li><p>调用jwt.sign方法，传递相应规则：        jwt.<strong>sign</strong>(“规则”, “加密名字”, “过期时间”, “箭头函数”);<br>加密名字secret可以在keys里面提前定义好:  secretOrKey: “secret”,<br>↓</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">bcrypt.compare(password, user.password).then(<span class="function">(<span class="params">isMatch</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (isMatch) &#123;</span><br><span class="line">    <span class="keyword">const</span> rule = &#123; <span class="attr">id</span>: user.id, <span class="attr">name</span>: user.name &#125;;</span><br><span class="line">    jwt.sign(rule, keys.secretOrKey, &#123; <span class="attr">expiresIn</span>: <span class="number">3600</span> &#125;, <span class="function">(<span class="params">err, token</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        success: <span class="literal">true</span>,</span><br><span class="line">        token: <span class="string">&quot;Bearer &quot;</span> + token,   <span class="comment">//Bearer后有一个空格</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.status(<span class="number">400</span>).json(&#123; <span class="attr">password</span>: <span class="string">&quot;密码错误&quot;</span> &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p>调试下~ ok~拿到token</p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwi4bgprmj30ok0c3dh4.jpg"></p>
</li>
</ul>
</li>
</ul>
<p>↓</p>
<p>验证token：</p>
<ul>
<li><pre><code class="js">// $route GET api/users/current
// @desc  return current user
// @access private
router.get(&quot;/current&quot;, &quot;验证token&quot;, (req, res) =&gt; &#123;
  res.json(&#123; msg: &quot;success&quot; &#125;);
&#125;);
&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;- 用到passport来验证token&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - npm install passport  passport-jwt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - 在入口文件中先引入passport， 并初始化passport：app.use(passport.initialize())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#96;&amp;#96;&amp;#96;js&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#x2F;&amp;#x2F; passport 初始化&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    app.use(passport.initialize());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#x2F;&amp;#x2F; 引入passport.js代码，同时把上面const的passport传递，这样直接把代码写在passport.js里&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    require(&amp;quot;.&amp;#x2F;config&amp;#x2F;passport&amp;quot;)(passport);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;

- 在另外单独文件夹中配置passport

  - config--&gt;新建passport.js , 在passport-jwt官网下引入相关配置

&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; JwtStrategy = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;passport-jwt&amp;quot;&lt;/span&gt;).Strategy,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ExtractJwt = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;passport-jwt&amp;quot;&lt;/span&gt;).ExtractJwt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; mongoose = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;mongoose&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; User = mongoose.model(&lt;span class=&quot;string&quot;&gt;&amp;quot;users&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; keys = &lt;span class=&quot;built_in&quot;&gt;require&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;../config/keys&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;const&lt;/span&gt; opts = &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;opts.jwtFromRequest = ExtractJwt.fromAuthHeaderAsBearerToken();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;opts.secretOrKey = keys.secretOrKey;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;passport&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;

↓

&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;built_in&quot;&gt;module&lt;/span&gt;.exports = &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;passport&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  passport.use(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; JwtStrategy(opts, &lt;span class=&quot;function&quot;&gt;(&lt;span class=&quot;params&quot;&gt;jwt_payload, done&lt;/span&gt;) =&amp;gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &lt;span class=&quot;built_in&quot;&gt;console&lt;/span&gt;.log(jwt_payload);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;

↓

配置完成，来到users.js 引入passport后，添加接口

&lt;!--hexoPostRenderEscape:&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// $route GET api/users/current&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// @desc  return current user&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// @access private&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;router.get(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &lt;span class=&quot;string&quot;&gt;&amp;quot;/current&amp;quot;&lt;/span&gt;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  passport.authenticate(&lt;span class=&quot;string&quot;&gt;&amp;quot;jwt&amp;quot;&lt;/span&gt;, &amp;#123; &lt;span class=&quot;attr&quot;&gt;session&lt;/span&gt;: &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt; &amp;#125;),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  (req, res) =&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    res.json(&amp;#123; &lt;span class=&quot;attr&quot;&gt;msg&lt;/span&gt;: &lt;span class=&quot;string&quot;&gt;&amp;quot;success&amp;quot;&lt;/span&gt; &amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;:hexoPostRenderEscape--&gt;

将刚拿到的token，放到current接口的header中，测试一下，终端会返回，因为在passport.use里我们写了console.log~  👆
👇
![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghwi70e0u2j30ae03k749.jpg)

</code></pre>
</li>
</ul>
<p>  ↓</p>
<p>  既然拿到了数据，就可以通过查询后返回用户信息</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">passport</span>) =&gt;</span> &#123;</span><br><span class="line">  passport.use(</span><br><span class="line">    <span class="keyword">new</span> JwtStrategy(opts, <span class="function">(<span class="params">jwt_payload, done</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(jwt_payload);</span><br><span class="line">      User.findById(jwt_payload.id)</span><br><span class="line">        .then(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">if</span> (user) &#123;</span><br><span class="line">            <span class="keyword">return</span> DOMError(<span class="literal">null</span>, user);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">return</span> done(<span class="literal">null</span>, <span class="literal">false</span>);</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.log(err));</span><br><span class="line">    &#125;)</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>  ↓</p>
<p>  调整下返回的代码，只返回user对象中的id,name, email </p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $route GET api/users/current</span></span><br><span class="line"><span class="comment">// @desc  return current user</span></span><br><span class="line"><span class="comment">// @access private</span></span><br><span class="line">router.get(</span><br><span class="line">  <span class="string">&quot;/current&quot;</span>,</span><br><span class="line">  passport.authenticate(<span class="string">&quot;jwt&quot;</span>, &#123; <span class="attr">session</span>: <span class="literal">false</span> &#125;),</span><br><span class="line">  (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;</span><br><span class="line">      id: req.user.id,</span><br><span class="line">      name: req.user.name,</span><br><span class="line">      email: req.user.email,</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>↓</p>
<p>增加身份字段，添加权限（项目中用不到权限管理的可以忽略这一步）</p>
<ul>
<li>在User.js里添加identity字段</li>
<li>在users.js 接口文件中的newUser中补上identity</li>
<li>在登录接口位置，在isMath规则处和res.json处添加identity</li>
</ul>
<p>↓</p>
<p>login、register、current 三个接口测试通过<br><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwjusnjrvj30l00f9q4l.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwjv4a1roj30na0eegnj.jpg"></p>
<p><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghwjwn1ssbj30kg04amxd.jpg"></p>
<p>↓<br>明天继续~ 晚安🐶</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2019/01/20/Formatting-problem-VUE-after-VScode-updating/">Formatting problem(VUE) after VScode updating</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2019-01-20T11:38:40.000Z" itemprop="datePublished">Jan 20, 2019</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/bugs-problems/">bugs/problems</a>
</div>
    </div>
      
        <p>i’v been disgusted by the format of vue code on VScode these days after its update. Checked all the extensions i’ve made before, still couldn’t solve the problem.</p>
<p>So i had to uninstall formatter-related extensions on my VScode this morning, and checked one by one to see if there’s any conflict among these extensions.</p>
<p>By the way, i’d like to tell about some disgusting errors first……🤯🤯🤯</p>
<p>i can’t make the code (expecially the js and vue code in my vue project) formatted according to eslint automatically after “ctr+s”, some snippets still show unexpected format which the parase can’t analyze…</p>
<p>Such as :</p>
<p>👉this <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu0rcvw2vj309603ymx6.jpg"> </p>
<p>👉and this <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu0tdsn9cj307j02c746.jpg"  /></p>
<p>👉and this<img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghu0vbxmj1j304i0433yf.jpg"></p>
<p>…….</p>
<p>🤢🤢🤢🤢</p>
<p>feel bad</p>
<p>…..</p>
<p>feel disgusting</p>
<p>…..</p>
<p>Thanks to “Enthusiastic Netizens” and “MY Persistence”…</p>
<p>i find answer here below🙏🙏</p>
<p>Step ①</p>
<p>of course you should add some extensions:</p>
<p>Vetur  </p>
<p>Eslint</p>
<p>Prettier</p>
<p>↓</p>
<p>Step②</p>
<p>you should add some codes in your settings.json, too</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&quot;eslint.validate&quot;: [</span><br><span class="line">    &quot;javascript&quot;,</span><br><span class="line">    &quot;javascriptreact&quot;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;language&quot;</span>: <span class="string">&quot;vue&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;autoFix&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;eslint.autoFixOnSave&quot;: true,</span><br><span class="line">  &quot;editor.codeActionsOnSave&quot;: &#123;</span><br><span class="line">    &quot;source.fixAll.eslint&quot;: true</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;editor.formatOnSave&quot;: true,</span><br><span class="line">  &quot;editor.formatOnPaste&quot;: true,</span><br><span class="line">  &quot;editor.formatOnType&quot;: true,</span><br><span class="line">  &quot;vetur.format.defaultFormatter.js&quot;: &quot;vscode-typescript&quot;,</span><br><span class="line">  &quot;javascript.format.insertSpaceBeforeFunctionParenthesis&quot;: true,</span><br><span class="line">  &quot;vetur.format.defaultFormatter.html&quot;: &quot;prettier&quot;,</span><br><span class="line">  &quot;editor.tabSize&quot;: 2,</span><br></pre></td></tr></table></figure>

<p>Edited by <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000014785115">https://segmentfault.com/a/1190000014785115</a></p>
<p>↓</p>
<p>to solve “newline at the end “ warning, you can add this line in your .eslintrc.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;eol-last&#x27;</span>: <span class="string">&#x27;off&#x27;</span></span><br></pre></td></tr></table></figure>

<p>↓</p>
<p>to solve the indent and single quote regulation of vue, you can build .prettierrc in your projec, add codes</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;tabWidth&quot;</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;semi&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">    <span class="attr">&quot;singleQuote&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;bracketSpacing&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>…</p>
<p>Ok ~ down</p>
<p>💪</p>

      
	</div>

<div class="meta">
	
</div>
</article>


  <nav id="pagenavi">
    
    
        <a href="/page/2/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2020

    JTW
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
