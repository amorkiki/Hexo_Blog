---
title: vue_shop--login branch
date: 2018-11-20 18:31:07
tags: vue
categories: project-share
top_img: false
indexing: true
---

## å‰ç«¯é¡¹ç›®è„šæ‰‹æ¶åˆå§‹åŒ– ï¼ˆç•¥ç•¥ç•¥ ğŸ‘…ï¼‰

## åå°é¡¹ç›®çš„ç¯å¢ƒå®‰è£…é…ç½®

> 1 å®‰è£… MySQL æ•°æ®åº“ --ç»™äºˆ XAMMP
>
> 2 å®‰è£… Node.js ç¯å¢ƒ âœ…
>
> 3 é…ç½®é¡¹ç›®ç›¸å…³ä¿¡æ¯
>
> 4 å¯åŠ¨é¡¹ç›®
>
> 5 ä½¿ç”¨ Postman æµ‹è¯•åå°é¡¹ç›®æ¥å£æ˜¯å¦æ­£å¸¸
>
> - åœ¨ api æ–‡ä»¶å¤¹ä¸­å®‰è£…ä¾èµ–åŒ…
> - ç”¨ node å‘½ä»¤æ‰§è¡Œ app.js
> - æŸ¥çœ‹ api æ¥å£æ–‡æ¡£
> - åŸºäºç™»å½•æ¥å£ï¼Œæµ‹è¯•æ¥å£æ˜¯å¦æ­£å¸¸å·¥ä½œï¼š
>   - å®‰è£… postman
>   - è¾“å…¥è¦æµ‹è¯•çš„è¯·æ±‚æ–¹å¼ï¼Œåœ°å€ä»¥åŠå…¶ä»–å‚æ•°å¯åœ¨ body é‡Œè®¾ç½®ï¼Œ
>   - ç‚¹å‡» send

> ç”¨ XAMMP å¯¼å…¥ç»™äºˆçš„ SQL æ–‡ä»¶ï¼š
>
> - å¯åŠ¨ XAMMPï¼Œæ‰“å¼€ network
> - http://localhost:8080/phpmyadmin è¿›å…¥ myadmin
> - åˆ›å»ºæ–°æ•°æ®åº“ vue_shop
> - å¯¼å…¥ sql æ–‡ä»¶

---

### ç™»å½•ä¸šåŠ¡çš„ç›¸å…³æŠ€æœ¯ç‚¹ noted~ğŸ¤­

1. http æ˜¯æ— çŠ¶æ€çš„
2. é€šè¿‡ cookie åœ¨å®¢æˆ·ç«¯è®°å½•çŠ¶æ€
3. é€šè¿‡ session åœ¨æœåŠ¡å™¨ç«¯è®°å½•çŠ¶æ€ ï¬
4. é€šè¿‡ token æ–¹å¼ç»´æŒçŠ¶æ€

> - localStorageï¼šæŒä¹…åŒ–å­˜å‚¨
> - sessionStorageï¼šä¼šè¯æ—¶å­˜å‚¨

---

### ğŸ§  æ“ä½œè¦ç‚¹æ­¥éª¤åˆ†æï¼š

#### ç™»å½•é¡µé¢å¸ƒå±€æ³¨æ„ç‚¹ï¼š

- åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹å†™ä»£ç ä¹‹å‰ï¼Œå…ˆ git status ä¸€ä¸‹ï¼Œçœ‹å½“å‰å·¥ä½œåŒºæ˜¯å¦å¹²å‡€

- > ç™»å½•ç»„ä»¶å¸ƒå±€ï¼š
  >
  > - èƒŒæ™¯é¢œè‰² åœ¨æ ¹ç›’å­ div ä¸­æ·»åŠ  class åï¼Œåœ¨ä¸‹é¢ style ä¸­å†™ç›¸åº”çš„ class
  >
  > - æ·»åŠ åé¡µé¢å‡ºç°æŠ¥é”™ Can't resolve 'less-loader
  >
  > - å› ä¸ºè¦ä½¿ç”¨ less å¿…é¡»å…ˆé…ç½® less-loader
  >
  >   - åœ¨ä¾èµ–ä¸­å®‰è£… less-loader åœ¨å¼€å‘ä¾èµ–ä¸­
  >   - åˆå› ä¸º less-loader æ˜¯åœ¨ less ä¸‹æ‰§è¡Œçš„ï¼Œå†å®‰è£…ä¸€ä¸‹ less
  >
  > - è¿è¡Œåå‘ç°èƒŒæ™¯è‰²å¹¶æ²¡æœ‰é“ºæ»¡é¡µé¢ï¼Œæ§åˆ¶å°ä¸­æ£€æŸ¥å‘ç°æ˜¯ HTML å…ƒç´ æ²¡æœ‰é“ºæ»¡å…¨å±
  >
  > - ä¿®æ”¹ç›¸åº”å…ƒç´ çš„æ ·å¼ï¼Œä½¿å¾—å…¶é“ºæ»¡å…¨å±
  >
  >   - åœ¨ src ä¸‹çš„ assets é‡Œæ–°å»º css æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å»ºç«‹ global.css ç¾¤å±…æ ·å¼è¡¨--ï¼ˆé™æ€æ–‡ä»¶æ·»åŠ 
  >
  >   - ```css
  >     /* å…¨å±€æ ·å¼è¡¨ */
  >     html,
  >     body,
  >     #app {
  >       height: 100%;
  >       margin: 0;
  >       padding: 0;
  >     }
  >     ```
  >
  >   - å¯¼å…¥å…¨å±€æ ·å¼è¡¨åˆ° main.js
  >
  >   - é¡µé¢ä¸­æŸ¥çœ‹æ•ˆæœï¼Œå‘ç° HTML å’Œ body ç­‰å…ƒç´ å·²ç»æ’‘æ»¡å±å¹•
  >
  > - æ‰¾åˆ°è®¾ç½®èƒŒæ™¯çš„ div ç›’å­ï¼Œä¹Ÿè®©ä»–æ’‘æ»¡å±å¹•ï¼ˆè¿™ä¸ªåœ¨ Login.vue ä¸­å†™å“¦~~ï¼‰

> - å¯†ç æ¡†å’Œç”¨æˆ·åå‰çš„å°å›¾æ ‡
>
>   - åœ¨ el-input é‡Œæ·»åŠ  prefix-icon="el-icon-search"
>
> - å›¾æ ‡è·Ÿæ¢ï¼šé€šè¿‡ç¬¬ä¸‰æ–¹å›¾æ ‡åº“--é˜¿é‡Œå›¾æ ‡åº“
>
>   - ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š
>
>     ç¬¬ä¸€æ­¥ï¼šå¼•å…¥é¡¹ç›®ä¸‹é¢ç”Ÿæˆçš„ fontclass ä»£ç ï¼š
>
>     ```html
>     <link rel="stylesheet" type="text/css" href="./iconfont.css" />
>     ```
>
>     ç¬¬äºŒæ­¥ï¼šæŒ‘é€‰ç›¸åº”å›¾æ ‡å¹¶è·å–ç±»åï¼Œåº”ç”¨äºé¡µé¢ï¼š
>
>     ```css
>     <i class="iconfont icon-xxx"></i>
>     ```
>
>     > "iconfont"æ˜¯ä½ é¡¹ç›®ä¸‹çš„ font-familyã€‚å¯ä»¥é€šè¿‡ç¼–è¾‘é¡¹ç›®æŸ¥çœ‹ï¼Œé»˜è®¤æ˜¯"iconfont"ã€‚
>
> - å°† fonts æ–‡ä»¶å¤¹æ”¾å…¥ assets é‡Œ
>
> - åœ¨å…¥å£æ–‡ä»¶ä¸­å¯¼å…¥å­—ä½“å›¾æ ‡ main.js
>
>   ```js
>   import "./assets/fonts/iconfont.css";
>   ```
>
> - ç»„ä»¶ä¸­æ·»åŠ  icon

> - ç™»å½•å‰çš„é¢„æ ¡éªŒ
>
>   - Form Methods é‡Œæœ‰ä¸ª validate å‡½æ•°ï¼Œæ¥å—ä¸€ä¸ª callback å›è°ƒï¼Œå›è°ƒå‡½æ•°ä¼šåœ¨æ ¡éªŒç»“æŸåè¢«è°ƒç”¨ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰
>
>   - æ‹¿åˆ°è¡¨å•å¼•ç”¨å¯¹è±¡, ç»‘å®šç™»å½•æŒ‰é’®çš„å•å‡»äº‹ä»¶ loginï¼Œåœ¨ methods é‡Œæ·»åŠ äº‹ä»¶ login
>
>   - validate å‡½æ•°æ¥æ”¶çš„å›è°ƒå‡½æ•°ç”¨ç®­å¤´å‡½æ•°ï¼Œè¿”å›çš„ valid å€¼æ—¶å¸ƒå°”å€¼
>
>     ```js
>     login () {
>       this.$refs.loginFormRef.validate(valid => {
>         console.log(valid)
>       })
>     }
>     ```

---

### å®ç°ç™»å½•

#### ğŸ§›â€â™€ï¸axios åŒ…å®ç°åŸç†åˆ†æ~

> - æ ¹æ®éªŒè¯ç»“æœå†³å®šæ˜¯å¦å‘å…·ä½“çš„ç™»å½•è¯·æ±‚
>
>   - æ¥ç€ä¸Šé¢çš„ login çš„ç®­å¤´å‡½æ•°ï¼Œæ·»åŠ ä¸€ä¸ª if åˆ¤æ–­
>
>     ```js
>     //å¦‚æœä¸é€šè¿‡ï¼Œç›´æ¥return,ä¸å‘èµ·è¯·æ±‚
>     if (!valid) return;
>     ```
>
>   - å¦‚æœ valid æ˜¯ trueï¼Œåˆ™å¯ä»¥å‘èµ·ç™»å½•è¯·æ±‚---éœ€è¦å…¨å±€é…ç½® axios åŒ…
>
>     - åœ¨ main.js é‡Œå…¨å±€å¼•å…¥ import axios from 'axios'
>     - å°†è¿™ä¸ªåŒ…æŒ‚è½½åˆ° vue çš„åŸå‹å¯¹è±¡ä¸Šï¼ŒVue.prototype.\$http = axiosï¼Œ
>     - è¿™æ ·æ¯ä¸ª vue ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡ this è®¿é—®\$http, ä»è€Œå»å‘èµ· ajax è¯·æ±‚
>     - åœ¨ç»™ axios è®¾ç½®è¯·æ±‚æ ¹è·¯å¾„ï¼šaxios.defaults.baseURL = 'æ¥å£çš„åœ°å€'
>
>     ```js
>     // å¯¼å…¥axiosåŒ…
>     import axios from "axios";
>     // é…ç½®è¯·æ±‚çš„æ ¹è·¯å¾„
>     axios.defaults.baseURL = "https://api.naccl.top/vue/shop/api/private/v1/";
>     // å°†axiosæŒ‚åœ¨åˆ°VueåŸå‹ä¸Š
>     Vue.prototype.$http = axios;
>     ```
>
>   - å›åˆ° Login.vue ç»„ä»¶ï¼Œåœ¨ç®­å¤´å‡½æ•°ä¸­é€šè¿‡ this è®¿é—®åˆ°åŸå‹ä¸Šçš„\$http
>
>     ```js
>     const result = this.$http.post('login', loginForm)
>     console.log(result)
>     //ç‚¹å‡»ç™»å½•åï¼Œåœ¨æ§åˆ¶å°æ‹¿åˆ°ä¸€ä¸ªpromiseå¯¹è±¡
>     //è‹¥æœæŸä¸ªæ–¹æ³•è¿”å›çš„æ˜¯promiseï¼Œå¯ä»¥ç”¨asyncå’Œawaitç®€åŒ–promiseæ“ä½œ
>     â†“
>     â†“
>     login () {
>       this.$refs.loginFormRef.validate(async valid => {
>         // console.log(valid)
>         if (!valid) return
>         const result = await this.$http.post('login', this.loginForm)
>         console.log(result)
>       })
>     }
>     ```
>
>     - æ­¤æ—¶å†ç‚¹å‡»ç™»å½•åï¼Œæ‹¿åˆ°çš„å°±ä¸æ˜¯ promiseï¼Œè€Œæ˜¯ä¸€ä¸ª data æ•°æ®å¯¹è±¡ï¼Œé‡Œé¢æœ‰ 6 ä¸ªå±æ€§ï¼Œè¿™äº›éƒ½æ˜¯ axios ç»™æˆ‘ä»¬å°è£…å¥½çš„ï¼Œå…¶ä¸­çš„ data æ‰æ˜¯æœåŠ¡å™¨è¿”å›çš„çœŸå®æ•°æ®ï¼Œåªéœ€è¦ data å“¦
>       <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqsmizcqj30er03kgm3.jpg" style="zoom:150%;" />
>
>     - æ‰€ä»¥æˆ‘ä»¬è¦ä»å¯¹è±¡èº«ä¸Šï¼Œå°† data å±æ€§è§£æ„èµ‹å€¼å‡ºæ¥ï¼Œç”¨ const {data : res}ï¼Œå°† data è§£æ„ï¼Œå¹¶èµ‹å€¼ç»™ resï¼Œæ‰“å°ä¸‹ resï¼Œä»£è¡¨æ‹¿åˆ°çš„çœŸå®çš„æœåŠ¡å™¨æ•°æ®
>
>       ```js
>       const { data: res } = await this.$http.post("login", this.loginForm);
>       console.log(res);
>       ```
>
>       <img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqxtvokrj30b101vq2v.jpg" style="zoom:200%;" /><img src="https://tva1.sinaimg.cn/large/007S8ZIlly1ghsqzmfygrj30ei0213yk.jpg" style="zoom:200%;" />
>
>     - meta å¯¹è±¡é‡Œçš„æ•°æ®æ˜¾ç¤ºå‡ºç™»å½•æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œæ‰€ä»¥éœ€è¦æ¥ä¸ª if åˆ¤æ–­ç™»å½•çŠ¶æ€
>
>       ```js
>       if (res.meta.status !== 200) return console.log("ç™»å½•å¤±è´¥");
>       console.log("ç™»å½•æˆåŠŸ");
>       ```

#### ğŸ§›â€â™€ï¸token ä¿å­˜åŸç†åˆ†æ~

> - å°†ç™»å½•æˆåŠŸä¹‹åçš„ tokenï¼Œä¿å­˜åˆ°å®¢æˆ·ç«¯çš„ sessionStorage ä¸­
>
>   - é¡¹ç›®ä¸­ï¼Œé™¤äº†ç™»å½•ä¹‹å¤–çš„å…¶å®ƒæ¥å£ï¼Œå¿…é¡»åœ¨ç™»å½•ä¹‹åæ‰èƒ½è®¿é—®
>
>   - token åªåº”åœ¨å½“å‰ç½‘ç«™æ‰“å¼€æœŸé—´ç”Ÿæ•ˆï¼Œæ‰€ä»¥å°† token ä¿å­˜åœ¨ sessionStorage ä¸­
>
>     localStorageï¼šæŒä¹…åŒ–å­˜å‚¨
>
>     sessionStorageï¼šä¼šè¯æ—¶å­˜å‚¨
>
>   - å…ˆæ‰“å°ä¸‹ resï¼Œæ‹¿åˆ°ï¼š
>     ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghsro5j7ctj30eh058dga.jpg)
>
>   - data é‡Œçš„ token æ˜¯æˆ‘ä»¬è¦æ‹¿åˆ°çš„
>
>     ```js
>     window.seesionStorage.setItem("token", res.data.token);
>     ```
>
>   - å†è¿›è¡Œé¡µé¢è·³è½¬
>
>     ```js
>     this.$router.push("/home");
>     ```
>
>     è·³è½¬ä¹‹ååœ¨æ§åˆ¶å°ä¸­æ£€æŸ¥æ˜¯å¦æ‹¿åˆ° token
>
>     ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghsrw6dm2xj30ib06q74s.jpg)
>
> - é€šè¿‡ç¼–ç¨‹å¼å¯¼èˆªè·³è½¬åˆ°åå°ä¸»ä¸šï¼Œè·¯ç”±åœ°å€æ˜¯/home
>
>   - æ–°å»º Home.vue,å†™å¥½ä¸‰ä¸ªæ¡†æ¶
>   - åœ¨ router.js è·¯ç”±è§„åˆ™ä¸­ï¼Œå¼•å…¥/home è¿™ä¸ªè·¯åŠ²

---

#### ğŸ§›â€â™€ï¸ å¯¼èˆªå®ˆå«æ§åˆ¶æƒé™

> - å› ä¸º home é¡µé¢æ˜¯ä¸ªæœ‰æƒé™çš„é¡µé¢ï¼Œå½“åˆ é™¤ token æ—¶ï¼Œåˆ·æ–°é¡µé¢ï¼Œéœ€è¦é‡æ–°å®šä½åˆ°ç™»å½•é¡µé¢ï¼Œè€Œä¸æ˜¯ç•™åœ¨ home é¡µé¢
>
>   - è¿ç”¨è·¯ç”±å¯¼èˆªå®ˆå«ï¼Œä¸ºè·¯ç”±å¯¹è±¡è°ƒç”¨ beforeEach å‡½æ•°ï¼Œå®ƒæ¥æ”¶å›è°ƒå‡½æ•°ï¼ŒåŒ…å« 3 ä¸ªå½¢å‚ï¼ˆtoï¼Œfromï¼Œnextï¼‰
>
>     - to å°†è¦è®¿é—®çš„è·¯å¾„
>     - from ä»å“ªä¸ªè·¯å¾„è·³è½¬
>     - next æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¡¨ç¤ºæ”¾è¡Œ
>       - next() ç›´æ¥ next æ”¾è¡Œ
>       - next('/login') ç»™ä¸ªè·¯å¾„è¡¨ç¤ºè¦å¼ºåˆ¶è·³è½¬çš„é¡µé¢
>
>   - åœ¨ router é‡Œçš„ index.js ä¸­ï¼Œ
>
>     ```js
>     // æŒ‚è½½è·¯ç”±å¯¼èˆªå®ˆå«
>     router.beforeEach((to, from, next) => {
>       if (to.path === "/login") return next();
>       // è·å–token
>       const tokenStr = window.sessionStorage.getItem("token");
>       if (!tokenStr) return next("/login");
>       next();
>     });
>     ```

### ä¸€äº›è¯­æ³•é—®é¢˜ã®è§£å†³

Eslint æ£€æŸ¥å‡ºçš„é—®é¢˜---ç¼©è¿›ï¼›åˆ†å·ï¼›ç©ºæ ¼Â·Â·Â·Â·ä¸€ç³»åˆ—çƒ¦äººã®ä¸è§„èŒƒ ğŸ¤¯

è§£å†³ï¼š

æ ¹ç›®å½•ä¸­åˆ›å»ºæ–‡ä»¶ .prettierrc, ä»–æ˜¯ json æ ¼å¼

```json
{
  "tabWidth": 2,
  "semi": false,
  "singleQuote": true,
  "bracketSpacing": true
}
```
