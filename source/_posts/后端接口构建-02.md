---
title: 后端接口构建-02
date: 2019-3-03 16:48:34
tags: [nodejs, myProject]
top_img: false
categories: project-share
aside: true
indexing: true
cover: https://tva1.sinaimg.cn/large/0081Kckwly1gkfm6ofo0dj31400u0q8j.jpg
---

啦啦啦~
今天内容比较简单，配置信息的增删改查接口，没有啥好说的，就是细心，直接上代码啦~👇

配置信息接口

- 创建 model--Profile.js

- 按照 User.js 格式进行修改

  ```js
  const mongoose = require("mongoose");
  const Schema = mongoose.Schema;

  // Create Schema
  const ProfileSchema = new Schema({
    type: {
      type: String,
      required: true,
    },
    b_name: {
      type: String,
      required: true,
    },
    author: {
      type: String,
      required: true,
    },
    isbn_num: {
      type: String,
    },
    status: {
      type: String,
    },
    remark: {
      type: String,
    },
    date: {
      type: Date,
      default: Date.now,
    },
  });

  module.exports = Profile = mongoose.model("profile", ProfileSchema);
  ```

- 在 routers 里创建 profiles.js 接口文件

- 到入口文件 server.js 中引入 profiles.js，并使用

  ```js
  //引入profiles.js
  const profiles = require("./routers/api/profiles");

  app.use("/api/profiles", profiles);
  ```

- 配置 profiles.js 文件，同样引入 express，router，passport，以及 Profile 模型（Profile.js），先写个测试 get 请求，测试一下

  ```js
  const express = require("express");
  const router = express.Router();
  const passport = require("passport");

  const Profile = require("../../models/Profile");

  // $route GET api/profiles/test
  // @desc  返回请求的json数据
  // @access public
  router.get("/test", (req, res) => {
    res.json({ msg: "profile works" });
  });

  module.exports = router;
  ```

  ↓

  ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghxaamvf3vj30ek0c7jrp.jpg)

接口 OK 了，接下来要获取到一些信息，添加、编辑、删除

↓

- 添加信息接口 POST 请求

```js
// $route POST api/profiles/add
// @desc  创建信息接口
// @access private
router.post(
  "/add",
  passport.authenticate("jwt", { session: false }),
  (req, res) => {
    const profileFields = {};

    if (req.body.type) profileFields.type = req.body.type;
    if (req.body.b_name) profileFields.b_name = req.body.b_name;
    if (req.body.author) profileFields.author = req.body.author;
    if (req.body.isbn_num) profileFields.isbn_num = req.body.isbn_num;
    if (req.body.status) profileFields.status = req.body.status;
    if (req.body.remark) profileFields.remark = req.body.remark;

    new Profile(profileFields).save().then((profile) => {
      res.json(profile);
    });
  }
);
```

- 测试一下~
  ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghxc514z5ij30k70ey75i.jpg)

↓

获取信息

- 获取全部信息，这里直接采用 GET 就行

  ```js
  // $route GET api/profiles/
  // @desc  获取所有信息接口
  // @access private
  router.get(
    "/",
    passport.authenticate("jwt", { session: false }),
    (req, res) => {
      Profile.find()
        .then((profile) => {
          if (!profile) {
            return res.status(404).json("没找到这条内容呀@_@");
          }

          res.json(profile);
        })
        .catch((err) => res.status(404).json(err));
    }
  );
  ```

  测试一下~
  ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghxcmar20zj30i60hmwfw.jpg)

- 获取单个信息

  还是采用 GET 方式，只是这里采用 findOne()

  ```js
  // $route GET api/profiles/:id
  // @desc  获取单个信息接口
  // @access private
  router.get(
    "/:id",
    passport.authenticate("jwt", { session: false }),
    (req, res) => {
      Profile.findOne({ _id: req.params.id })
        .then((profile) => {
          if (!profile) {
            return res.status(404).json("没找到这条内容呀@_@");
          }

          res.json(profile);
        })
        .catch((err) => res.status(404).json(err));
    }
  );
  ```

  测试一下~

  ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghxcsrrxadj30hf0g0q4a.jpg)

↓

编辑内容（类似添加内容）

这里使用 findOneAndUpdate 方法

```js
// $route POST api/profiles/edit
// @desc  编辑信息接口
// @access private
router.post(
  "/edit/:id",
  passport.authenticate("jwt", { session: false }),
  (req, res) => {
    const profileFields = {};

    if (req.body.type) profileFields.type = req.body.type;
    if (req.body.b_name) profileFields.b_name = req.body.b_name;
    if (req.body.author) profileFields.author = req.body.author;
    if (req.body.isbn_num) profileFields.isbn_num = req.body.isbn_num;
    if (req.body.status) profileFields.status = req.body.status;
    if (req.body.remark) profileFields.remark = req.body.remark;

    Profile.findOneAndUpdate(
      { _id: req.params.id },
      { $set: profileFields },
      { new: true }
    ).then((profile) => res.json(profile));
  }
);
```

- 测试（修改前端-->前端 IT）
  ![](https://tva1.sinaimg.cn/large/007S8ZIlly1ghxd1awbzxj30gb0e875g.jpg)

↓

删除内容

```js
// $route POST api/profiles/delete/:id
// @desc  删除信息接口
// @access private
router.delete(
  "/delete/:id",
  passport.authenticate("jwt", { session: false }),
  (req, res) => {
    Profile.findOneAndRemove({ _id: req.params.id })
      .then((profile) => {
        profile.save().then((profile) => res.json(profile));
      })
      .catch((err) => res.status(404).res.json("删除失败啦~ >_<"));
  }
);
```
